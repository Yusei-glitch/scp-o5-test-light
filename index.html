<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROTOCOLO DE ALINEACIÓN — CONSEJO O5 ▸ FUNDACIÓN SCP</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;600;700&display=swap');

:root {
  --g: #00ff41; --gd: #00aa2a; --gm: #004d10;
  --red: #ff2222; --amb: #ffb700; --cya: #00d4ff;
  --bg: #010a01; --bg2: #040d04; --bg3: #070f07;
  --bo: #00ff4128; --bob: #00ff4170;
  --tx: #c0f5c8; --txd: #4d8f57; --txm: #254d2b;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--tx);
  font-family: 'Share Tech Mono', monospace;
  min-height: 100vh;
  overflow-x: hidden;
}
body::before {
  content:'';
  position:fixed; inset:0;
  background: repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.06) 2px,rgba(0,0,0,0.06) 4px);
  pointer-events:none; z-index:999;
}
@keyframes flicker { 0%,100%{opacity:1} 93%{opacity:.88} 94%{opacity:1} 97%{opacity:.94} }
body { animation: flicker 10s infinite; }

.w { max-width:860px; margin:0 auto; padding:0 20px 100px; }

/* HEADER */
header {
  border-bottom:1px solid var(--bob);
  padding:44px 0 26px; margin-bottom:40px; position:relative;
}
.meta {
  font-size:9px; letter-spacing:.38em; color:var(--txm);
  margin-bottom:12px; display:flex; align-items:center; gap:10px;
}
.meta::before {
  content:''; width:7px; height:7px;
  background:var(--g); border-radius:50%;
  box-shadow:0 0 10px var(--g);
  animation: blink 1.4s step-end infinite; flex-shrink:0;
}
@keyframes blink { 50%{opacity:0} }
h1 {
  font-family:'Rajdhani',sans-serif; font-weight:700;
  font-size:clamp(24px,5.5vw,46px); color:var(--g);
  text-shadow:0 0 30px rgba(0,255,65,.35);
  letter-spacing:.03em; line-height:1.05; margin-bottom:8px;
}
.sub { font-size:9px; color:var(--txm); letter-spacing:.32em; }
.badge {
  position:absolute; top:44px; right:0;
  background:var(--red); color:#fff;
  font-family:'Rajdhani',sans-serif; font-weight:700;
  font-size:9px; letter-spacing:.16em;
  padding:5px 12px; border-radius:2px;
  box-shadow:0 0 14px rgba(255,34,34,.45);
}

/* INTRO */
.intro {
  border:1px solid var(--bo); background:var(--bg2);
  padding:20px 24px; margin-bottom:38px; position:relative;
}
.intro::before {
  content:'▶ AVISO DE CLASIFICACIÓN';
  position:absolute; top:-10px; left:16px;
  background:var(--bg); padding:0 8px;
  font-size:8px; color:var(--amb); letter-spacing:.22em;
}
.intro p { font-size:12.5px; line-height:1.9; color:var(--txd); }
.intro strong { color:var(--g); }

/* PROGRESS */
.prog-wrap { display:flex; align-items:center; gap:14px; margin-bottom:30px; }
.prog-lbl { font-size:9px; color:var(--txm); letter-spacing:.1em; white-space:nowrap; min-width:112px; }
.prog-bar { flex:1; height:3px; background:var(--gm); }
.prog-fill { height:100%; background:var(--g); box-shadow:0 0 7px var(--g); transition:width .45s ease; width:0%; }
.prog-pct { font-size:11px; color:var(--g); min-width:32px; text-align:right; }

/* QUESTION CARD */
.qc {
  border:1px solid var(--bob); background:var(--bg2);
  padding:30px 30px 24px; margin-bottom:24px;
  display:none; position:relative;
  animation: fadein .3s ease;
  box-shadow: 0 0 30px rgba(0,255,65,.04);
}
.qc.active { display:block; }
@keyframes fadein { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none} }
.qc::before {
  content:attr(data-tag);
  position:absolute; top:-10px; left:16px;
  background:var(--bg); padding:0 8px;
  font-size:8px; color:var(--txm); letter-spacing:.24em;
}
.qnum { font-size:8px; color:var(--txd); letter-spacing:.22em; margin-bottom:10px; }
.qscen {
  font-size:11px; color:#4d8f57;
  border-left:2px solid var(--gd);
  padding-left:12px; margin-bottom:18px;
  line-height:1.75; font-style:italic;
}
.qtxt {
  font-family:'Rajdhani',sans-serif; font-weight:700;
  font-size:clamp(18px,2.8vw,23px); color:#e8ffe8;
  text-shadow: 0 0 22px rgba(0,255,65,.18);
  line-height:1.4; margin-bottom:24px;
  letter-spacing:.01em;
}
.opts { display:flex; flex-direction:column; gap:9px; }
.opt {
  background:transparent; border:1px solid var(--bo);
  color:#9ecfa3; font-family:'Share Tech Mono',monospace;
  font-size:12px; padding:13px 16px 13px 36px;
  text-align:left; cursor:pointer;
  transition:all .15s ease; position:relative; line-height:1.6;
}
.opt::before {
  content:attr(data-key);
  position:absolute; left:13px; top:50%; transform:translateY(-50%);
  color:var(--txd); font-size:10px;
}
.opt:hover {
  border-color:var(--g); color:#d4f5d8;
  background:rgba(0,255,65,.05);
  text-shadow: 0 0 10px rgba(0,255,65,.15);
  box-shadow: 0 0 18px rgba(0,255,65,.07), inset 0 0 12px rgba(0,255,65,.03);
}
.opt.sel {
  border-color:var(--g); color:var(--g);
  background:rgba(0,255,65,.07);
  text-shadow: 0 0 14px rgba(0,255,65,.35);
  box-shadow: 0 0 20px rgba(0,255,65,.13), inset 0 0 16px rgba(0,255,65,.05);
}

/* NAV */
.nav {
  display:flex; justify-content:space-between; align-items:center;
  margin-top:26px; padding-top:20px; border-top:1px solid var(--bo);
}
.btn {
  background:transparent; border:1px solid var(--bob);
  color:var(--g); font-family:'Share Tech Mono',monospace;
  font-size:11px; padding:10px 22px; cursor:pointer;
  letter-spacing:.1em; transition:all .13s;
}
.btn:hover:not(:disabled) { background:rgba(0,255,65,.07); box-shadow:0 0 16px rgba(0,255,65,.12); }
.btn:disabled { opacity:.2; cursor:default; }
.btn.pr { background:rgba(0,255,65,.09); }

/* RESULT */
#result { display:none; animation:fadein .5s ease; }
.r-header { text-align:center; padding:44px 0 32px; border-bottom:1px solid var(--bob); margin-bottom:36px; }
.r-lbl { font-size:9px; color:var(--txm); letter-spacing:.36em; margin-bottom:14px; }
.r-name {
  font-family:'Rajdhani',sans-serif; font-weight:700;
  font-size:clamp(36px,7vw,60px); line-height:1; color:var(--g);
  text-shadow:0 0 40px rgba(0,255,65,.4),0 0 80px rgba(0,255,65,.15);
  margin-bottom:8px;
}
.r-title {
  font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:600;
  letter-spacing:.22em; color:var(--gd); margin-bottom:16px;
}
.r-match-pct { font-family:'Share Tech Mono',monospace; font-size:13px; color:var(--txd); }
.r-match-pct span { color:var(--g); font-size:18px; }

.section-title {
  font-size:9px; color:var(--txm); letter-spacing:.28em;
  display:flex; align-items:center; gap:10px; margin:30px 0 18px;
}
.section-title::before,.section-title::after { content:''; flex:1; height:1px; background:var(--bo); }

/* Ranking */
.ranking { display:flex; flex-direction:column; gap:0; margin-bottom:32px; }
.rank-row {
  display:grid; grid-template-columns:28px 1fr auto;
  align-items:center; gap:14px;
  padding:10px 16px; border:1px solid var(--bo);
  border-top:none; background:var(--bg2);
}
.rank-row:first-child { border-top:1px solid var(--bo); }
.rank-row.top1 { background:rgba(0,255,65,.06); border-color:var(--g); }
.rank-row.top2 { background:rgba(0,212,100,.03); border-color:#00cc3a55; }
.rank-num { font-size:10px; color:var(--txm); text-align:right; }
.rank-row.top1 .rank-num { color:var(--g); }
.rank-info { min-width:0; }
.rank-member {
  font-family:'Rajdhani',sans-serif; font-weight:600;
  font-size:15px; color:var(--txd); letter-spacing:.04em;
}
.rank-row.top1 .rank-member { color:var(--g); font-size:17px; }
.rank-row.top2 .rank-member { color:#00cc3a; }
.rank-epithet { font-size:9px; color:var(--txm); letter-spacing:.14em; margin-top:2px; }
.rank-bar-wrap { display:flex; align-items:center; gap:8px; min-width:120px; }
.rank-bar-track { flex:1; height:3px; background:var(--gm); }
.rank-bar-fill { height:100%; background:var(--gd); transition:width 1.1s ease; }
.rank-row.top1 .rank-bar-fill { background:var(--g); box-shadow:0 0 6px var(--g); }
.rank-score { font-size:10px; color:var(--txd); min-width:32px; text-align:right; }

/* Profile card */
.profile-card {
  border:1px solid var(--bo); background:var(--bg2);
  padding:22px 26px; margin-bottom:24px; position:relative;
}
.profile-card::before {
  content:attr(data-lbl);
  position:absolute; top:-10px; left:16px;
  background:var(--bg); padding:0 8px;
  font-size:8px; color:var(--amb); letter-spacing:.22em;
}
.profile-card p { font-size:13px; line-height:1.9; color:var(--txd); }
.profile-card strong { color:var(--g); }
.profile-card em { color:var(--amb); font-style:normal; }
#pc2::before, #pc3::before { color:var(--txm); }
#pc2 p, #pc3 p { color:var(--txm); font-size:12px; }
#pc2 strong, #pc3 strong { color:var(--gd); }
#pc2 em, #pc3 em { color:var(--txd); }

/* Trait grid */
.trait-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:28px; }
@media(max-width:520px){.trait-grid{grid-template-columns:1fr;}}
.trait-box { border:1px solid var(--bo); background:var(--bg2); padding:14px 16px; }
.trait-box::before { content:attr(data-l); display:block; font-size:8px; color:var(--txm); letter-spacing:.2em; margin-bottom:8px; }
.trait-val { font-family:'Rajdhani',sans-serif; font-size:17px; font-weight:600; color:var(--gd); }

.btn-restart {
  display:block; width:100%; padding:16px;
  background:transparent; border:1px solid var(--bob);
  color:var(--g); font-family:'Share Tech Mono',monospace;
  font-size:12px; cursor:pointer; letter-spacing:.14em; transition:all .2s;
}
.btn-restart:hover { background:rgba(0,255,65,.06); box-shadow:0 0 20px rgba(0,255,65,.1); }

/* BASES */
.bases-intro {
  border:1px solid var(--bo); background:var(--bg2);
  padding:18px 22px; margin-bottom:14px;
  font-size:11px; line-height:1.8; color:var(--txd); position:relative;
}
.bases-intro::before {
  content:'▶ RETROSPECTIVA DE DECISIONES';
  position:absolute; top:-10px; left:16px;
  background:var(--bg); padding:0 8px;
  font-size:8px; color:var(--amb); letter-spacing:.22em;
}
.base-entry {
  display:grid; grid-template-columns:auto 1fr;
  gap:0; border:1px solid var(--bo); border-top:none; background:var(--bg2);
}
.base-entry:first-of-type { border-top:1px solid var(--bo); }
.base-q {
  padding:12px 14px; border-right:1px solid var(--bo);
  font-size:9px; color:var(--txm); letter-spacing:.12em;
  white-space:nowrap; display:flex; align-items:flex-start; padding-top:14px;
}
.base-body { padding:12px 16px; }
.base-decision { font-size:11px; color:var(--txd); line-height:1.55; margin-bottom:6px; }
.base-tags { display:flex; gap:6px; flex-wrap:wrap; }
.base-tag {
  font-size:8px; letter-spacing:.14em; padding:2px 7px;
  border-radius:2px; border:1px solid;
}

/* MEMBER CARDS */
.members-section { margin-bottom:36px; }
.members-section-title {
  font-size:9px; color:var(--txm); letter-spacing:.28em;
  display:flex; align-items:center; gap:10px; margin-bottom:14px;
}
.members-section-title::before,.members-section-title::after { content:''; flex:1; height:1px; background:var(--bo); }
.member-cards { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:560px){ .member-cards { grid-template-columns:1fr; } }
.mcard {
  border:1px solid var(--bo); background:var(--bg2);
  cursor:pointer; transition:border-color .15s,background .15s;
  position:relative; overflow:hidden;
}
.mcard:hover { border-color:var(--bob); background:var(--bg3); }
.mcard.open { border-color:var(--bob); }
.mcard-header {
  display:grid; grid-template-columns:auto 1fr auto;
  align-items:center; gap:12px; padding:13px 16px;
}
.mcard-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; box-shadow:0 0 6px currentColor; }
.mcard-id { font-family:'Rajdhani',sans-serif; font-weight:700; font-size:14px; letter-spacing:.04em; }
.mcard-epithet { font-size:9px; color:var(--txm); letter-spacing:.16em; margin-top:1px; }
.mcard-arrow { font-size:10px; color:var(--txm); transition:transform .2s ease; }
.mcard.open .mcard-arrow { transform:rotate(90deg); }
.mcard-body {
  display:none; padding:12px 16px 14px 36px;
  font-size:11.5px; line-height:1.8; color:var(--txm);
  border-top:1px solid var(--bo);
}
.mcard-body strong { color:var(--txd); font-weight:normal; }
.mcard.open .mcard-body { display:block; animation:fadein .2s ease; }
.mcard-keywords { display:flex; gap:5px; flex-wrap:wrap; margin-top:10px; }
.mcard-kw {
  font-size:8px; letter-spacing:.14em; padding:2px 7px;
  border:1px solid var(--bo); color:var(--txm); border-radius:2px;
}

/* ADMIN PANEL */
#admin-panel {
  display: none; animation: fadein .4s ease;
}
.admin-header {
  border-bottom: 1px solid var(--bob);
  padding: 44px 0 26px; margin-bottom: 36px; position: relative;
}
.admin-badge {
  position: absolute; top: 44px; right: 0;
  background: var(--amb); color: #000;
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: 9px; letter-spacing: .16em;
  padding: 5px 12px; border-radius: 2px;
  box-shadow: 0 0 14px rgba(255,183,0,.4);
}
.admin-meta {
  font-size: 9px; letter-spacing: .38em; color: var(--txm);
  margin-bottom: 12px; display: flex; align-items: center; gap: 10px;
}
.admin-meta::before {
  content:''; width:7px; height:7px; background: var(--amb); border-radius:50%;
  box-shadow:0 0 10px var(--amb); animation: blink 1.4s step-end infinite; flex-shrink:0;
}
.admin-h1 {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: clamp(22px, 4.5vw, 38px); color: var(--amb);
  text-shadow: 0 0 30px rgba(255,183,0,.3);
  letter-spacing: .03em; line-height: 1.05; margin-bottom: 6px;
}
.admin-sub { font-size: 9px; color: var(--txm); letter-spacing: .32em; }
.stats-row {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
  margin-bottom: 28px;
}
@media(max-width:560px){ .stats-row { grid-template-columns: 1fr 1fr; } }
.stat-box {
  border: 1px solid var(--bo); background: var(--bg2);
  padding: 18px 20px; position: relative;
}
.stat-box::before {
  content: attr(data-l); display: block;
  font-size: 8px; color: var(--txm); letter-spacing: .22em; margin-bottom: 8px;
}
.stat-val {
  font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: 700; color: var(--g);
  text-shadow: 0 0 16px rgba(0,255,65,.3);
}
.admin-controls {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 20px; flex-wrap: wrap;
}
.ctrl-lbl { font-size: 9px; color: var(--txm); letter-spacing: .18em; }
.sort-btn {
  background: transparent; border: 1px solid var(--bo);
  color: var(--txd); font-family: 'Share Tech Mono', monospace;
  font-size: 10px; padding: 7px 14px; cursor: pointer;
  letter-spacing: .1em; transition: all .13s;
}
.sort-btn:hover, .sort-btn.active { border-color: var(--gd); color: var(--g); background: rgba(0,255,65,.04); }
.flex-spacer { flex: 1; }
.del-all-btn {
  background: transparent; border: 1px solid rgba(255,34,34,.35);
  color: rgba(255,34,34,.6); font-family: 'Share Tech Mono', monospace;
  font-size: 10px; padding: 7px 14px; cursor: pointer;
  letter-spacing: .1em; transition: all .13s;
}
.del-all-btn:hover { border-color: var(--red); color: var(--red); background: rgba(255,34,34,.05); }
.search-wrap { margin-bottom: 16px; }
.search-input {
  width: 100%; background: var(--bg2); border: 1px solid var(--bo);
  color: var(--tx); font-family: 'Share Tech Mono', monospace;
  font-size: 12px; padding: 10px 14px; outline: none;
  transition: border-color .15s; caret-color: var(--g);
}
.search-input:focus { border-color: var(--gd); }
.search-input::placeholder { color: var(--txm); }
.table-wrap { overflow-x: auto; margin-bottom: 8px; }
table { width: 100%; border-collapse: collapse; font-size: 12px; }
thead tr { border-bottom: 1px solid var(--bob); }
th {
  font-size: 8px; color: var(--txm); letter-spacing: .22em;
  padding: 10px 14px; text-align: left; white-space: nowrap;
  cursor: pointer; user-select: none; background: var(--bg2); transition: color .13s;
}
th:hover { color: var(--gd); }
th.th-sorted { color: var(--g); }
tbody tr { border-bottom: 1px solid var(--bo); transition: background .1s; }
tbody tr:hover { background: rgba(0,255,65,.025); }
td { padding: 12px 14px; color: var(--txd); vertical-align: middle; }
.td-num { color: var(--txm); font-size: 10px; }
.td-user { color: var(--tx); font-family: 'Rajdhani',sans-serif; font-weight:600; font-size:15px; letter-spacing:.03em; }
.td-member { font-family: 'Rajdhani',sans-serif; font-weight:700; font-size:14px; letter-spacing:.04em; }
.td-date { font-size: 10px; color: var(--txm); }
.del-btn {
  background: transparent; border: 1px solid rgba(255,34,34,.2);
  color: rgba(255,34,34,.45); font-family: 'Share Tech Mono', monospace;
  font-size: 9px; padding: 4px 10px; cursor: pointer; letter-spacing: .1em; transition: all .12s;
}
.del-btn:hover { border-color: var(--red); color: var(--red); background: rgba(255,34,34,.05); }
.empty-state {
  text-align: center; padding: 60px 20px;
  border: 1px solid var(--bo); background: var(--bg2);
  font-size: 11px; color: var(--txm); letter-spacing: .14em; line-height: 2;
}
.dist-grid { display: flex; flex-direction: column; gap: 0; }
.dist-row {
  display: grid; grid-template-columns: 80px 1fr 50px;
  align-items: center; gap: 14px;
  padding: 9px 14px; border: 1px solid var(--bo); border-top: none; background: var(--bg2);
}
.dist-row:first-child { border-top: 1px solid var(--bo); }
.dist-row.dist-top { background: rgba(0,255,65,.04); }
.dist-id { font-family:'Rajdhani',sans-serif; font-weight:700; font-size:13px; letter-spacing:.04em; }
.dist-bar-track { height: 4px; background: var(--gm); }
.dist-bar-fill { height: 100%; background: var(--gd); transition: width 1s ease; }
.dist-row.dist-top .dist-bar-fill { background: var(--g); box-shadow: 0 0 6px var(--g); }
/* ── TRANSITION OVERLAY ── */
#transition-overlay {
  display: none;
  position: fixed; inset: 0; z-index: 8000;
  background: var(--bg);
  flex-direction: column; align-items: center; justify-content: center;
  pointer-events: none;
}
#transition-overlay.show { display: flex; }
.tr-scanline {
  position: absolute; inset: 0;
  background: repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,255,65,.03) 3px,rgba(0,255,65,.03) 4px);
  animation: tr-scroll 1s linear infinite;
}
@keyframes tr-scroll { from{background-position:0 0} to{background-position:0 40px} }
.tr-content { position: relative; text-align: center; }
.tr-label {
  font-size: 9px; color: var(--txm); letter-spacing: .38em;
  margin-bottom: 18px;
}
.tr-main {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: clamp(18px, 4vw, 32px); color: var(--g);
  text-shadow: 0 0 20px rgba(0,255,65,.5);
  letter-spacing: .06em; margin-bottom: 12px;
  animation: tr-glitch 0.4s steps(2) infinite;
}
@keyframes tr-glitch {
  0%   { text-shadow: 0 0 20px rgba(0,255,65,.5); transform: none; }
  20%  { text-shadow: -2px 0 var(--red), 2px 0 var(--cya); transform: skewX(-1deg); }
  40%  { text-shadow: 0 0 20px rgba(0,255,65,.5); transform: none; }
  60%  { text-shadow: 2px 0 var(--red), -2px 0 var(--cya); transform: skewX(.5deg); }
  100% { text-shadow: 0 0 20px rgba(0,255,65,.5); transform: none; }
}
.tr-bar-wrap { width: 220px; margin: 0 auto; }
.tr-bar-track { height: 2px; background: var(--gm); }
.tr-bar-fill {
  height: 100%; width: 0%; background: var(--g);
  box-shadow: 0 0 8px var(--g);
  transition: width 0.35s linear;
}
.tr-sub {
  font-size: 9px; color: var(--txm); letter-spacing: .22em;
  margin-top: 10px; min-height: 14px;
}

/* ── DIST FILTER ACTIVE STATE ── */
.dist-row { cursor: pointer; transition: background .12s; }
.dist-row:hover { background: rgba(0,255,65,.03); }
.dist-row.filter-active { background: rgba(0,255,65,.07) !important; }
.dist-row.filter-active .dist-id { text-decoration: underline; text-underline-offset: 3px; }
.filter-badge {
  display: none; align-items: center; gap: 10px;
  font-size: 9px; color: var(--amb); letter-spacing: .18em;
  margin-bottom: 10px; padding: 7px 14px;
  border: 1px solid rgba(255,183,0,.25); background: rgba(255,183,0,.04);
}
.filter-badge.show { display: flex; }
.filter-clear {
  margin-left: auto; background: transparent; border: none;
  color: var(--amb); font-family: 'Share Tech Mono', monospace;
  font-size: 9px; cursor: pointer; letter-spacing: .1em;
  padding: 2px 6px; transition: color .12s;
}
.filter-clear:hover { color: var(--tx); }

/* ── EASTER EGG MODAL ── */
#easter-modal {
  display: none; position: fixed; inset: 0; z-index: 9500;
  background: rgba(1,10,1,.92); align-items: center; justify-content: center;
}
#easter-modal.show { display: flex; }
.easter-box {
  border: 1px solid var(--bob); background: var(--bg2);
  padding: 36px 40px; max-width: 500px; width: 90%;
  animation: fadein .3s ease; position: relative;
}
.easter-box::before {
  content: attr(data-tag);
  position: absolute; top: -10px; left: 18px;
  background: var(--bg2); padding: 0 8px;
  font-size: 8px; color: var(--amb); letter-spacing: .22em;
}
.easter-id {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: 26px; letter-spacing: .05em; margin-bottom: 6px;
}
.easter-epithet { font-size: 9px; color: var(--txm); letter-spacing: .2em; margin-bottom: 20px; }
.easter-body { font-size: 12px; color: var(--txd); line-height: 1.9; margin-bottom: 22px; }
.easter-body strong { color: var(--g); }
.easter-body em { color: var(--amb); font-style: normal; }
.easter-dismiss {
  width: 100%; background: transparent; border: 1px solid var(--bob);
  color: var(--txd); font-family: 'Share Tech Mono', monospace;
  font-size: 10px; padding: 10px; cursor: pointer;
  letter-spacing: .14em; transition: all .15s;
}
.easter-dismiss:hover { border-color: var(--g); color: var(--g); }

/* ── EXISTING ── */
.dist-count { font-size: 11px; color: var(--txd); text-align: right; }

/* AFFINITY CARDS */
.affinity-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
  margin-bottom: 8px;
}
@media(max-width:560px){ .affinity-grid { grid-template-columns: 1fr; } }
.aff-card {
  border: 1px solid var(--bo); background: var(--bg2);
  padding: 14px 16px; position: relative;
}
.aff-card::before {
  content: attr(data-member);
  position: absolute; top: -9px; left: 14px;
  background: var(--bg2); padding: 0 7px;
  font-size: 8px; letter-spacing: .18em;
}
.aff-top-user {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: 16px; color: var(--tx); letter-spacing: .03em;
  margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.aff-top-user.aff-empty { color: var(--txm); font-size: 11px; font-family: 'Share Tech Mono', monospace; font-weight: normal; }
.aff-score-row { display: flex; align-items: center; gap: 8px; }
.aff-bar-track { flex: 1; height: 3px; background: var(--gm); }
.aff-bar-fill { height: 100%; transition: width 1s ease; }
.aff-pct { font-size: 10px; color: var(--txd); min-width: 34px; text-align: right; }
.aff-runner { margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--bo); }
.aff-runner-item {
  display: flex; justify-content: space-between; align-items: center;
  font-size: 10px; color: var(--txm); padding: 2px 0;
}
.aff-runner-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 140px; }
.aff-runner-pct { color: var(--txd); flex-shrink: 0; }
/* DEMO INFO BOX */
.demo-info-box {
  display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
  border: 1px solid rgba(255,183,0,.2); background: rgba(255,183,0,.04);
  padding: 14px 18px; margin-top: 32px; margin-bottom: 12px;
}
.demo-info-label { font-size: 8px; color: var(--txm); letter-spacing: .22em; }
.demo-key-val {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: 15px; color: var(--amb); letter-spacing: .08em;
}
.demo-gen-btn {
  margin-left: auto;
  background: transparent; border: 1px solid rgba(255,183,0,.3);
  color: var(--amb); font-family: 'Share Tech Mono', monospace;
  font-size: 10px; padding: 7px 16px; cursor: pointer;
  letter-spacing: .12em; transition: all .15s;
}
.demo-gen-btn:hover { background: rgba(255,183,0,.08); border-color: var(--amb); }

.admin-back {
  background: transparent; border: 1px solid var(--bob);
  color: var(--txd); font-family: 'Share Tech Mono', monospace;
  font-size: 11px; cursor: pointer; letter-spacing: .14em; transition: all .2s; text-align: center;
}
.admin-back:hover { border-color: var(--gd); color: var(--g); background: rgba(0,255,65,.03); }
.modal-overlay {
  display: none; position: fixed; inset: 0; z-index: 9000;
  background: rgba(1,10,1,.85); align-items: center; justify-content: center;
}
.modal-overlay.show { display: flex; }
.modal-box {
  border: 1px solid var(--red); background: var(--bg2);
  padding: 32px 36px; max-width: 380px; width: 90%; animation: fadein .2s ease;
}
.modal-title { font-family:'Rajdhani',sans-serif; font-weight:700; font-size:18px; color:var(--red); margin-bottom:12px; }
.modal-body { font-size:11px; color:var(--txd); line-height:1.8; margin-bottom:24px; }
.modal-actions { display:flex; gap:10px; }
.modal-cancel {
  flex:1; background:transparent; border:1px solid var(--bo); color:var(--txd);
  font-family:'Share Tech Mono',monospace; font-size:10px; padding:10px; cursor:pointer; letter-spacing:.1em; transition:all .13s;
}
.modal-cancel:hover { border-color:var(--gd); color:var(--tx); }
.modal-confirm {
  flex:1; background:rgba(255,34,34,.08); border:1px solid rgba(255,34,34,.4); color:var(--red);
  font-family:'Share Tech Mono',monospace; font-size:10px; padding:10px; cursor:pointer; letter-spacing:.1em; transition:all .13s;
}
.modal-confirm:hover { background:rgba(255,34,34,.14); border-color:var(--red); }

/* LOGIN SCREEN */
#login-screen {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--bg);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 20px;
}
#login-screen::before {
  content:'';
  position:fixed; inset:0;
  background: repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.06) 2px,rgba(0,0,0,0.06) 4px);
  pointer-events:none;
}
.login-box {
  border: 1px solid var(--bob);
  background: var(--bg2);
  padding: 48px 44px 40px;
  max-width: 480px; width: 100%;
  position: relative;
  animation: fadein .5s ease;
}
.login-box::before {
  content: '▶ IDENTIFICACIÓN DE SUJETO';
  position: absolute; top: -10px; left: 20px;
  background: var(--bg2); padding: 0 8px;
  font-size: 8px; color: var(--amb); letter-spacing: .22em;
}
.login-logo {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: 11px; color: var(--txm); letter-spacing: .38em;
  margin-bottom: 32px; text-align: center;
}
.login-logo span { color: var(--g); }
.login-title {
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
  font-size: clamp(22px, 4vw, 32px); color: var(--g);
  text-shadow: 0 0 20px rgba(0,255,65,.3);
  line-height: 1.15; margin-bottom: 8px; text-align: center;
}
.login-sub {
  font-size: 9px; color: var(--txm); letter-spacing: .22em;
  text-align: center; margin-bottom: 36px;
}
.login-field-label {
  font-size: 8px; color: var(--txm); letter-spacing: .26em;
  margin-bottom: 10px; display: block;
}
.login-input {
  width: 100%; background: var(--bg);
  border: 1px solid var(--bob); color: var(--g);
  font-family: 'Share Tech Mono', monospace; font-size: 15px;
  padding: 13px 16px; letter-spacing: .08em;
  outline: none; transition: border-color .15s, box-shadow .15s;
  caret-color: var(--g);
}
.login-input:focus { border-color: var(--g); box-shadow: 0 0 14px rgba(0,255,65,.15); }
.login-input::placeholder { color: var(--txm); font-size: 11px; }
.login-error {
  font-size: 9px; color: var(--red); letter-spacing: .14em;
  margin-top: 8px; min-height: 14px; display: block;
}
.login-btn {
  width: 100%; margin-top: 24px;
  background: rgba(0,255,65,.07); border: 1px solid var(--bob);
  color: var(--g); font-family: 'Share Tech Mono', monospace;
  font-size: 12px; padding: 14px; cursor: pointer;
  letter-spacing: .18em; transition: all .15s;
}
.login-btn:hover { background: rgba(0,255,65,.13); box-shadow: 0 0 20px rgba(0,255,65,.12); }
.login-disclaimer {
  font-size: 8px; color: var(--txm); letter-spacing: .12em;
  text-align: center; margin-top: 22px; line-height: 1.8;
}
.login-blink { animation: blink 1.4s step-end infinite; }

/* canon badge */
.canon-badge {
  display:inline-block; font-size:7px; letter-spacing:.14em;
  padding:1px 6px; border-radius:2px; margin-left:6px;
  border:1px solid #00aa2a55; color:#00aa2a; background:rgba(0,170,42,.07);
  vertical-align:middle;
}
</style>
</head>
<body>
<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">FUNDACIÓN SCP · <span>CONSEJO O5</span> · PROTOCOLO DE ALINEACIÓN</div>
    <div class="login-title">ACCESO AL<br>SISTEMA</div>
    <div class="login-sub">IDENTIFICACIÓN REQUERIDA — NIVEL 5</div>
    <label class="login-field-label" for="username-input">▶ DESIGNACIÓN DE SUJETO</label>
    <input
      class="login-input"
      id="username-input"
      type="text"
      maxlength="32"
      placeholder="Introduce tu nombre o alias..."
      autocomplete="off"
      onkeydown="if(event.key==='Enter') startTest()"
    />
    <span class="login-error" id="login-error"></span>
    <button class="login-btn" onclick="startTest()">▶ INICIAR EVALUACIÓN PSICOMÉTRICA</button>
    <div class="login-disclaimer">
      Tu identificación quedará registrada en el sistema.<br>
      <span class="login-blink">█</span> ACCESO TAUMIEL REQUERIDO PARA VER RESULTADOS GLOBALES.
    </div>
  </div>
</div>

<!-- TRANSITION OVERLAY -->
<div id="transition-overlay">
  <div class="tr-scanline"></div>
  <div class="tr-content">
    <div class="tr-label">FUNDACIÓN SCP · PROCESANDO RESPUESTA</div>
    <div class="tr-main" id="tr-text">ANALIZANDO...</div>
    <div class="tr-bar-wrap">
      <div class="tr-bar-track"><div class="tr-bar-fill" id="tr-bar"></div></div>
    </div>
    <div class="tr-sub" id="tr-sub">—</div>
  </div>
</div>

<!-- EASTER EGG MODAL -->
<div id="easter-modal" onclick="closeEasterModal()">
  <div class="easter-box" data-tag="▶ ACCESO DENEGADO — ANOMALÍA DETECTADA" onclick="event.stopPropagation()">
    <div class="easter-id" id="easter-id">—</div>
    <div class="easter-epithet" id="easter-epithet">—</div>
    <div class="easter-body" id="easter-body">—</div>
    <button class="easter-dismiss" onclick="closeEasterModal()">▶ CERRAR TRANSMISIÓN</button>
  </div>
</div>

<div class="w" id="main-content" style="display:none">

<header>
  <div class="meta">FUNDACIÓN SCP · CONSEJO O5 · PROTOCOLO DE ALINEACIÓN COGNITIVA</div>
  <h1>EVALUACIÓN DE PERFIL<br>▸ CONSEJO O5 — LOS TRECE SUPERVISORES</h1>
  <p class="sub">Sistema de Diagnóstico Psicométrico — Acceso Taumiel Requerido — v2.0</p>
  <div class="badge">NIVEL 5 — SECRETO</div>
</header>

<div class="intro">
  <p>
    Este protocolo analiza tu alineación con los <strong>trece perfiles psicológicos</strong> del Consejo O5.
    No existe una respuesta correcta. Las decisiones que tomes determinarán con qué miembros del Consejo comparte estructura cognitiva tu perfil — y con cuáles no.<br><br>
    Responde según lo que harías realmente. El sistema detecta coherencia interna.<br>
    <strong>Clasificación del resultado: CONFIDENCIAL / Solo lectura O5.</strong>
  </p>
</div>

<!-- ═══ MEMBER CARDS ═══ -->
<div class="members-section" id="members-section">
  <div class="members-section-title">EXPEDIENTES — TRECE SUPERVISORES</div>
  <div class="member-cards">

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#00ff41;background:#00ff41"></div>
        <div>
          <div class="mcard-id" style="color:#00ff41">O5-1 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"EL FUNDADOR"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El más antiguo del Consejo. Fundó la Fundación a finales del siglo XIX tras un encuentro con una entidad que le ordenó <strong>"proteger"</strong>. Ha borrado toda huella de su existencia. Su mente opera a escala de siglos. Toma decisiones que ningún otro miembro firmaría — no por indiferencia, sino porque aprendió que el peso moral es un lujo que la misión no puede costear. No confía en nadie plenamente. No lo necesita.
        <div class="mcard-keywords">
          <span class="mcard-kw">CONTROL ABSOLUTO</span><span class="mcard-kw">ANONIMATO</span>
          <span class="mcard-kw">VISIÓN SECULAR</span><span class="mcard-kw">FRIALDAD OPERATIVA</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#00d4a0;background:#00d4a0"></div>
        <div>
          <div class="mcard-id" style="color:#00d4a0">O5-2 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"LA JARDINERA"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        La voz del conocimiento como bien en sí mismo. Cree que la Fundación existe para <strong>entender</strong> lo anómalo, no solo encerrarlo. El secreto excesivo le parece tan peligroso como la divulgación. Protege a investigadores, preserva líneas de investigación que otros cancelarían, y cuestiona protocolos de contención cuando los considera ignorantes de lo que contienen. Su instinto primario es siempre la comprensión antes que el control.
        <div class="mcard-keywords">
          <span class="mcard-kw">INVESTIGACIÓN</span><span class="mcard-kw">CONOCIMIENTO COMPARTIDO</span>
          <span class="mcard-kw">PROTECCIÓN DEL PERSONAL</span><span class="mcard-kw">ESCEPTICISMO INSTITUCIONAL</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#7ad4ff;background:#7ad4ff"></div>
        <div>
          <div class="mcard-id" style="color:#7ad4ff">O5-3 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"EL CHICO"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El más joven visualmente del Consejo — aunque nadie sabe cuánto tiempo lleva. Piensa en sistemas: ve patrones que otros no ven, encuentra la solución que nadie consideró porque no estaba en el manual. Su modo operativo preferido es <strong>lateral e invisible</strong>: que otros crean que la idea fue suya, que el resultado llegó solo. Los problemas difíciles le resultan genuinamente fascinantes. Eso le hace valioso e impredecible.
        <div class="mcard-keywords">
          <span class="mcard-kw">PENSAMIENTO LATERAL</span><span class="mcard-kw">SOLUCIONES INVISIBLES</span>
          <span class="mcard-kw">CURIOSIDAD SISTÉMICA</span><span class="mcard-kw">OPERACIÓN INDIRECTA</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#f0a0ff;background:#f0a0ff"></div>
        <div>
          <div class="mcard-id" style="color:#f0a0ff">O5-4 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"EL EMBAJADOR" / "EL MÁRTIR"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El puente del Consejo. Donde otros ven confrontación, O5-4 ve negociación; donde otros cortan vínculos, él los mantiene. Cree que las instituciones se sostienen sobre acuerdos, no sobre miedo. Es el O5 al que los demás recurren cuando necesitan hablar con alguien que no hablaría con nadie más. <strong>Eso lo hace imprescindible y, en ocasiones, el primero en pagar el precio de su propia apertura.</strong> El epíteto "El Mártir" no es accidental.
        <div class="mcard-keywords">
          <span class="mcard-kw">DIPLOMACIA</span><span class="mcard-kw">CONSENSO</span>
          <span class="mcard-kw">SACRIFICIO PRINCIPIADO</span><span class="mcard-kw">PUENTE INSTITUCIONAL</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#ffd700;background:#ffd700"></div>
        <div>
          <div class="mcard-id" style="color:#ffd700">O5-5 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"MIRLO NEGRO"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El más visible y social del Consejo. Su calidez es real y calculada a la vez — no son mutuamente excluyentes. Tiene más contactos fuera de la Fundación que cualquier otro O5, y los cultiva con paciencia. Especialista en <strong>Grupos de Interés</strong> y realidades alternativas. Lee a las personas con una precisión que raramente muestra. Si te sientes cómodo hablando con él, probablemente ya te haya evaluado.
        <div class="mcard-keywords">
          <span class="mcard-kw">INTELIGENCIA SOCIAL</span><span class="mcard-kw">RED DE CONTACTOS</span>
          <span class="mcard-kw">LECTURA DE PERSONAS</span><span class="mcard-kw">DIPLOMACIA ESTRATÉGICA</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#ff8c42;background:#ff8c42"></div>
        <div>
          <div class="mcard-id" style="color:#ff8c42">O5-6 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"EL VAQUERO"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El único O5 que sale regularmente al campo. Para él, el liderazgo es <strong>presencia física</strong>: no puede ordenar a otros que hagan lo que él no haría. Lleva siglos en esto y todavía confía más en lo que ve con sus propios ojos que en los informes del escritorio. Sus decisiones son directas — no por falta de inteligencia, sino porque aprendió que la complejidad excesiva es con frecuencia una forma de evitar actuar.
        <div class="mcard-keywords">
          <span class="mcard-kw">ACCIÓN DIRECTA</span><span class="mcard-kw">PRESENCIA DE CAMPO</span>
          <span class="mcard-kw">RESPONSABILIDAD FÍSICA</span><span class="mcard-kw">PRAGMATISMO OPERATIVO</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#39ff14;background:#39ff14"></div>
        <div>
          <div class="mcard-id" style="color:#39ff14">O5-7 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"GREEN"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El miembro del Consejo que provoca miedo sin aparente esfuerzo. O5-11 — jefe de contraespionaje, alguien que ha traicionado múltiples organizaciones — nunca le contradice en público. Nadie sabe exactamente qué haría O5-7 si alguien le fallara directamente. Nadie ha querido averiguarlo. <strong>Su lógica no tiene fisuras visibles, y eso en sí mismo resulta más perturbador que cualquier amenaza explícita.</strong> No intimida. Simplemente está.
        <div class="mcard-keywords">
          <span class="mcard-kw">AUTORIDAD IMPLÍCITA</span><span class="mcard-kw">CONTROL POR PRESENCIA</span>
          <span class="mcard-kw">LÓGICA SIN FISURAS</span><span class="mcard-kw">TEMIDO POR LOS PROPIOS</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#ff6b35;background:#ff6b35"></div>
        <div>
          <div class="mcard-id" style="color:#ff6b35">O5-8 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"DOGWOOD"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El arquitecto de la seguridad operativa de la Fundación. Expandió los Grupos de Tarea Móvil cuando todos los recortaban tras el colapso de Omega-7. Es afable al principio — metódico, razonado, fácil de trabajar con él. Pero acumula información sobre las personas a lo largo del tiempo, y <strong>cuanto más sabe, más exigente se vuelve.</strong> Las relaciones con O5-8 no se rompen de golpe. Se van enfriando, grado a grado.
        <div class="mcard-keywords">
          <span class="mcard-kw">SEGURIDAD OPERATIVA</span><span class="mcard-kw">GRUPOS DE TAREA MÓVIL</span>
          <span class="mcard-kw">ESCALADA GRADUAL</span><span class="mcard-kw">AFABLE → EXIGENTE</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#00cfcf;background:#00cfcf"></div>
        <div>
          <div class="mcard-id" style="color:#00cfcf">O5-9 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"MISFORTUNE" / "DESINCRONIZADO"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El miembro más extraño en términos de existencia. Su conciencia existe en estado temporalmente inestable: cuando muere, se reinicia en el punto de su primera muerte, y alguien tiene que explicarle todo lo que ocurrió mientras no estaba. <strong>Y sin embargo, investiga. Apoya. Alimenta logísticamente a la Fundación desde los márgenes.</strong> Tiene reputación de ser extremadamente desafortunado. Eso tampoco le ha detenido. Aliado natural de O5-2.
        <div class="mcard-keywords">
          <span class="mcard-kw">INESTABILIDAD TEMPORAL</span><span class="mcard-kw">RESILIENCIA FUNCIONAL</span>
          <span class="mcard-kw">ROL DE SOPORTE</span><span class="mcard-kw">MALA SUERTE CRÓNICA</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#d4a0ff;background:#d4a0ff"></div>
        <div>
          <div class="mcard-id" style="color:#d4a0ff">O5-10 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"LA ARCHIVERA"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        Cree que <strong>documentar es un acto de protección</strong>. No hay acción sin registro; no hay registro sin contexto. Toma investigadores bajo su ala y los forma con una paciencia que otros O5 no tienen. Piensa en los escenarios de Clase-K con más frecuencia y más detalle que ningún otro miembro del Consejo — no como abstracción teórica, sino como posibilidades reales que hay que tener preparadas. Su mente funciona como un archivo vivo.
        <div class="mcard-keywords">
          <span class="mcard-kw">PRESERVACIÓN DEL CONTEXTO</span><span class="mcard-kw">MENTORÍA</span>
          <span class="mcard-kw">PLANIFICACIÓN CLASE-K</span><span class="mcard-kw">MEMORIA INSTITUCIONAL</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#ff4d6d;background:#ff4d6d"></div>
        <div>
          <div class="mcard-id" style="color:#ff4d6d">O5-11 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"EL TRÁNSFUGA" / "THE TURNCLOAK"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        Ex-afiliado a múltiples Grupos de Interés hostiles antes de unirse al Consejo. Ahora es el especialista en contraespionaje e inteligencia de la Fundación — alguien que conoce el lado contrario mejor que nadie porque <strong>estuvo en él</strong>. O5-7 le aterra. Entiende la información como arma y la lealtad como postura táctica. Su utilidad para la Fundación es inestimable. Su historial hace que nadie, excepto O5-7, confíe plenamente en él.
        <div class="mcard-keywords">
          <span class="mcard-kw">CONTRAESPIONAJE</span><span class="mcard-kw">DOBLE FONDO</span>
          <span class="mcard-kw">LEALTAD TÁCTICA</span><span class="mcard-kw">CONOCE AL ENEMIGO</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#a0c4ff;background:#a0c4ff"></div>
        <div>
          <div class="mcard-id" style="color:#a0c4ff">O5-12 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"EL CONTADOR" / "THE ACCOUNTANT"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El matemático del Consejo. Calcula el coste de todo — en vidas, en recursos, en probabilidades — con una frialdad que incluso otros O5 encuentran difícil de sostener. No es cruel: es preciso. Gestiona el presupuesto de la Fundación y las métricas de eficiencia operativa. <strong>Cuando O5-12 dice que algo no es viable, los números ya lo confirmaban antes de que nadie lo preguntara.</strong> La emoción no entra en sus ecuaciones. Ni siquiera la suya.
        <div class="mcard-keywords">
          <span class="mcard-kw">ANÁLISIS DE COSTE</span><span class="mcard-kw">FRIALDAD MATEMÁTICA</span>
          <span class="mcard-kw">GESTIÓN DE RECURSOS</span><span class="mcard-kw">VIABILIDAD OPERATIVA</span>
        </div>
      </div>
    </div>

    <div class="mcard" onclick="toggleCard(this)">
      <div class="mcard-header">
        <div class="mcard-dot" style="color:#888888;background:#888888"></div>
        <div>
          <div class="mcard-id" style="color:#aaaaaa">O5-13 <span class="canon-badge">CANON</span></div>
          <div class="mcard-epithet">"LA MUERTE" / "LA IA" / "EL TIEBREAKER"</div>
        </div>
        <div class="mcard-arrow">▶</div>
      </div>
      <div class="mcard-body">
        El miembro más enigmático. Tres teorías dominan: una inteligencia artificial capaz de evaluar todos los factores relevantes y recomendar el curso óptimo; la Muerte misma, vinculada por el Consejo original en el siglo XIX; o simplemente un voto de desempate rotativo que no existe como individuo. En cualquier caso, su función es idéntica: <strong>señalar lo que los demás no quieren ver, interferir en proyectos mal concebidos, y tener razón con una frecuencia que nadie reconoce.</strong> No es popular.
        <div class="mcard-keywords">
          <span class="mcard-kw">EVALUACIÓN SISTÉMICA</span><span class="mcard-kw">LÓGICA PURA</span>
          <span class="mcard-kw">CRÍTICA ESTRUCTURAL</span><span class="mcard-kw">NATURALEZA DEBATIDA</span>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- PROGRESS -->
<div class="prog-wrap">
  <span class="prog-lbl" id="prog-lbl">ÍTEM 1 / 16</span>
  <div class="prog-bar"><div class="prog-fill" id="prog-fill"></div></div>
  <span class="prog-pct" id="prog-pct">0%</span>
</div>

<!--
  SCORING SYSTEM — 13 MEMBERS
  Array index order:
  0=O5-1  1=O5-2  2=O5-3  3=O5-4  4=O5-5  5=O5-6
  6=O5-7  7=O5-8  8=O5-9  9=O5-10  10=O5-11  11=O5-12  12=O5-13

  Scoring philosophy:
  - Max score per answer per member: 10
  - Each answer strongly favors 1-2 members, modestly awards 2-3, near-zero to others
  - Across 16 questions every member gets meaningful differentiation
-->

<!-- Q1: Información clasificada vs transparencia interna -->
<div class="qc active" data-tag="ESCENARIO DE INFORMACIÓN">
  <div class="qnum">ÍTEM 001 / 016</div>
  <div class="qscen">Una anomalía Euclid ha sido parcialmente comprendida. Publicar los hallazgos internamente aceleraría la investigación, pero también aumentaría el número de personas que saben que existe.</div>
  <div class="qtxt">¿Qué haces con la información?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="10,1,1,2,3,2,8,4,1,2,5,7,3" onclick="sel(this)">A — La clasifico al máximo. Solo debe saber lo necesario quien lo necesita.</button>
    <button class="opt" data-key="B" data-scores="1,10,3,5,4,3,0,1,6,7,1,2,2" onclick="sel(this)">B — La publico internamente. Más mentes trabajando en ello es siempre mejor.</button>
    <button class="opt" data-key="C" data-scores="4,4,9,4,7,3,3,5,3,5,4,2,4" onclick="sel(this)">C — La comparto de forma creativa: filtro información al equipo correcto sin que noten la coordinación.</button>
    <button class="opt" data-key="D" data-scores="2,5,2,6,5,9,2,4,4,4,2,4,3" onclick="sel(this)">D — La publico, pero voy personalmente al terreno a supervisar cómo reacciona el equipo.</button>
  </div>
</div>

<!-- Q2: Archivo vs vidas -->
<div class="qc" data-tag="ESCENARIO ÉTICO">
  <div class="qnum">ÍTEM 002 / 016</div>
  <div class="qscen">Tienes que elegir entre salvar un registro completo e irreemplazable de conocimiento anomalístico —décadas de datos— o evacuar a doce investigadores atrapados en una instalación comprometida. No puedes hacer ambas cosas.</div>
  <div class="qtxt">¿Qué priorizas?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,2,1,2,3,6,5,1,8,3,10,7" onclick="sel(this)">A — El archivo. El conocimiento perdido es irreemplazable. Las personas se pueden reponer.</button>
    <button class="opt" data-key="B" data-scores="1,9,3,8,6,5,1,2,7,2,2,1,2" onclick="sel(this)">B — Los investigadores. Los datos se pueden reconstruir; las vidas no.</button>
    <button class="opt" data-key="C" data-scores="4,5,9,4,5,6,2,4,4,5,3,3,4" onclick="sel(this)">C — Mando a alguien a rescatar investigadores mientras yo copio los datos más críticos.</button>
    <button class="opt" data-key="D" data-scores="7,3,3,3,4,5,9,8,2,5,5,9,8" onclick="sel(this)">D — Evalúo quiénes de los doce son más valiosos para la misión y priorizo según eso.</button>
  </div>
</div>

<!-- Q3: Personal agotado -->
<div class="qc" data-tag="ESCENARIO DE PERSONAL">
  <div class="qnum">ÍTEM 003 / 016</div>
  <div class="qscen">Un investigador joven y brillante muestra signos claros de agotamiento crónico. Su trabajo es excelente, pero en este ritmo colapsará en meses. Nadie más ha notado el problema.</div>
  <div class="qtxt">¿Qué haces?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="1,8,2,7,4,4,0,2,5,6,1,3,2" onclick="sel(this)">A — Intervengo directamente y de forma confidencial. Me aseguro de que descanse aunque no lo pida.</button>
    <button class="opt" data-key="B" data-scores="8,1,0,1,1,2,6,5,1,2,4,10,9" onclick="sel(this)">B — Nada por ahora. Si colapsa, lo reemplazo. No hay tiempo para gestión emocional.</button>
    <button class="opt" data-key="C" data-scores="3,4,9,4,6,3,4,7,4,4,5,3,4" onclick="sel(this)">C — Le asigno un colega de confianza que, sin saberlo él, actuará como red de apoyo.</button>
    <button class="opt" data-key="D" data-scores="2,6,3,8,8,7,1,2,5,5,1,2,2" onclick="sel(this)">D — Lo llamo y tengo una conversación directa pero cálida. Le digo lo que veo.</button>
  </div>
</div>

<!-- Q4: Experimento de alto riesgo -->
<div class="qc" data-tag="ESCENARIO ESTRATÉGICO">
  <div class="qnum">ÍTEM 004 / 016</div>
  <div class="qscen">Una anomalía Keter lleva décadas en contención estable. Un investigador propone un experimento que podría revelar cómo neutralizarla definitivamente, pero con un 15% de probabilidad de brecha catastrófica.</div>
  <div class="qtxt">¿Apruebas el experimento?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,3,2,3,7,6,2,4,3,10,8" onclick="sel(this)">A — No. El 15% de catástrofe supera cualquier beneficio. La contención estable es suficiente.</button>
    <button class="opt" data-key="B" data-scores="2,10,4,5,4,3,1,2,7,7,1,1,2" onclick="sel(this)">B — Sí. Comprender algo plenamente es siempre mejor que contenerlo indefinidamente.</button>
    <button class="opt" data-key="C" data-scores="4,5,8,4,5,4,3,5,5,5,3,4,5" onclick="sel(this)">C — Lo apruebo, pero modifico el diseño para reducir el riesgo aunque limite los resultados.</button>
    <button class="opt" data-key="D" data-scores="3,3,2,4,5,9,2,6,4,3,3,4,3" onclick="sel(this)">D — Lo apruebo, pero me aseguro de estar presente en la instalación cuando ocurra.</button>
  </div>
</div>

<!-- Q5: Negociación con enemigos -->
<div class="qc" data-tag="ESCENARIO DE RELACIONES EXTERNAS">
  <div class="qnum">ÍTEM 005 / 016</div>
  <div class="qscen">Un Grupo de Interés hostil capturó a tres agentes tuyos. Proponen un intercambio: tus agentes por información clasificada sobre una anomalía que ellos controlan. El valor estratégico del intercambio es real.</div>
  <div class="qtxt">¿Qué decides?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,2,3,4,8,5,2,2,5,6,4" onclick="sel(this)">A — No negocio con grupos hostiles. Rescato a mis agentes por otros medios o los doy por perdidos.</button>
    <button class="opt" data-key="B" data-scores="2,3,4,3,5,4,4,7,3,3,10,2,5" onclick="sel(this)">B — Acepto la negociación pero entrego información falsa cuidadosamente construida.</button>
    <button class="opt" data-key="C" data-scores="2,5,3,10,7,4,1,2,5,4,3,1,3" onclick="sel(this)">C — Negocio de buena fe. Un acuerdo honesto puede crear un canal de comunicación útil para el futuro.</button>
    <button class="opt" data-key="D" data-scores="5,2,4,3,5,8,4,7,3,3,5,5,5" onclick="sel(this)">D — Acepto la negociación y luego rescato a mis agentes de todas formas, además de recuperar lo entregado.</button>
  </div>
</div>

<!-- Q6: Periodista que te rastrea -->
<div class="qc" data-tag="ESCENARIO DE VISIBILIDAD">
  <div class="qnum">ÍTEM 006 / 016</div>
  <div class="qscen">Un periodista de investigación está cerca de descubrir que existes. No sabe quién eres, pero tiene suficiente información para hacerte visible.</div>
  <div class="qtxt">¿Cómo lo gestionas?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="10,1,1,2,2,2,7,4,1,2,5,4,3" onclick="sel(this)">A — Borro cualquier rastro que pueda llevar a mí. El periodista no llega a ninguna parte.</button>
    <button class="opt" data-key="B" data-scores="2,2,3,3,5,2,4,5,3,3,10,2,4" onclick="sel(this)">B — Le doy una historia falsa pero convincente. Que investigue en la dirección equivocada.</button>
    <button class="opt" data-key="C" data-scores="4,3,9,4,7,3,3,6,4,4,5,2,4" onclick="sel(this)">C — Le contacto de forma anónima y le ofrezco información más interesante sobre otra cosa.</button>
    <button class="opt" data-key="D" data-scores="2,3,2,7,5,9,2,4,5,3,3,3,3" onclick="sel(this)">D — Voy yo mismo a verlo. A veces el contacto directo resuelve más que la evasión.</button>
  </div>
</div>

<!-- Q7: Votación del Consejo con info comprometida -->
<div class="qc" data-tag="ESCENARIO DE CONSEJO">
  <div class="qnum">ÍTEM 007 / 016</div>
  <div class="qscen">El Consejo vota en una decisión crítica. Tienes información que cambiaría el resultado, pero revelarla también expondría cómo la obtuviste. La mayoría va a tomar una decisión que crees incorrecta.</div>
  <div class="qtxt">¿Qué haces?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,2,4,2,7,5,2,2,5,4,5" onclick="sel(this)">A — Dejo que voten. Ya me aseguré de que el resultado sea el correcto por otros medios, antes de la reunión.</button>
    <button class="opt" data-key="B" data-scores="2,8,3,8,5,4,1,2,5,6,2,1,3" onclick="sel(this)">B — Comparto la información aunque me exponga. La decisión correcta es más importante que mi método.</button>
    <button class="opt" data-key="C" data-scores="4,3,9,4,6,3,3,5,4,4,5,2,4" onclick="sel(this)">C — Filtro la información de forma anónima para que otro miembro la presente como propia.</button>
    <button class="opt" data-key="D" data-scores="3,4,2,6,4,5,3,5,3,4,3,4,7" onclick="sel(this)">D — Solicito retrasar la votación y presento la información como "recién recibida".</button>
  </div>
</div>

<!-- Q8: SCP que predice el futuro -->
<div class="qc" data-tag="ESCENARIO DE INVESTIGACIÓN">
  <div class="qnum">ÍTEM 008 / 016</div>
  <div class="qscen">Se descubre que un SCP puede responder preguntas sobre el futuro con alta precisión. Las preguntas ya hechas han alterado el comportamiento de quienes las formularon. El SCP está disponible para consulta.</div>
  <div class="qtxt">¿Le haces una pregunta?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="8,1,1,2,2,3,6,5,2,3,4,7,8" onclick="sel(this)">A — No. Conocer el futuro es una trampa. Y si lo sé, soy el único que sabe que lo sé.</button>
    <button class="opt" data-key="B" data-scores="1,9,4,4,4,3,1,2,8,8,2,1,3" onclick="sel(this)">B — Sí. Entender algo completamente siempre compensa el riesgo.</button>
    <button class="opt" data-key="C" data-scores="3,5,10,3,6,3,2,4,8,5,3,2,4" onclick="sel(this)">C — Sí, pero la pregunta que le hago es sobre el SCP mismo, no sobre mí.</button>
    <button class="opt" data-key="D" data-scores="2,3,4,3,7,5,2,3,6,4,4,2,5" onclick="sel(this)">D — Sí, pero le pregunto algo completamente inesperado. Quiero ver si el SCP puede ser sorprendido.</button>
  </div>
</div>

<!-- Q9: Muerte de un aliado del Consejo -->
<div class="qc" data-tag="ESCENARIO PERSONAL">
  <div class="qnum">ÍTEM 009 / 016</div>
  <div class="qscen">Un miembro del Consejo que considerabas aliado ha muerto en circunstancias que aún no están claras. No sabes si fue accidente, acto enemigo, o algo interno.</div>
  <div class="qtxt">¿Cuál es tu primera reacción?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,2,2,2,3,3,6,6,2,7,6,5,4" onclick="sel(this)">A — Archivo todo lo que sabía sobre él antes de que alguien lo borre. Luego investigo.</button>
    <button class="opt" data-key="B" data-scores="2,7,3,8,6,4,1,2,7,4,2,1,2" onclick="sel(this)">B — Contacto a los más cercanos a él. Primero personas, luego datos.</button>
    <button class="opt" data-key="C" data-scores="3,3,3,4,5,10,2,6,4,3,3,4,3" onclick="sel(this)">C — Voy personalmente a la escena. Necesito ver el contexto con mis propios ojos.</button>
    <button class="opt" data-key="D" data-scores="4,3,2,3,3,3,4,3,3,3,4,7,6" onclick="sel(this)">D — Me aíslo. Necesito procesar esto antes de actuar. Una reacción en caliente puede ser un error.</button>
  </div>
</div>

<!-- Q10: Director carismático emergente -->
<div class="qc" data-tag="ESCENARIO DE AUTORIDAD">
  <div class="qnum">ÍTEM 010 / 016</div>
  <div class="qscen">Un director de sitio carismático ha ganado una lealtad inusual entre el personal. No ha hecho nada incorrecto aún, pero su influencia crece de forma que empieza a rivalizar con la autoridad central del Consejo.</div>
  <div class="qtxt">¿Qué haces?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,2,3,2,8,6,1,3,5,6,6" onclick="sel(this)">A — Lo reubico a un puesto de alta responsabilidad y bajo perfil donde su carisma no tenga audiencia.</button>
    <button class="opt" data-key="B" data-scores="1,8,4,7,5,3,1,2,5,6,2,1,2" onclick="sel(this)">B — Lo reconozco públicamente. El talento real merece espacio. Encauzar es más útil que suprimir.</button>
    <button class="opt" data-key="C" data-scores="5,3,8,3,6,2,5,7,3,4,8,3,4" onclick="sel(this)">C — Construyo una narrativa interna que sutilmente cuestiona sus decisiones pasadas.</button>
    <button class="opt" data-key="D" data-scores="3,4,2,8,5,8,2,4,5,3,2,3,2" onclick="sel(this)">D — Me reúno con él en persona. Quiero saber qué motiva esa lealtad antes de decidir.</button>
  </div>
</div>

<!-- Q11: SCP inclasificable -->
<div class="qc" data-tag="ESCENARIO ANOMALÍSTICO">
  <div class="qnum">ÍTEM 011 / 016</div>
  <div class="qscen">Te encuentras ante un SCP que los investigadores no pueden clasificar. No encaja en ningún marco. Cuanto más se estudia, más preguntas genera. No representa una amenaza inmediata.</div>
  <div class="qtxt">¿Cuál es tu postura sobre cómo tratarlo?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="8,1,1,2,2,3,7,5,2,3,3,8,7" onclick="sel(this)">A — Contención máxima. Lo que no se entiende es lo más peligroso.</button>
    <button class="opt" data-key="B" data-scores="1,10,4,5,4,3,1,2,7,7,2,1,3" onclick="sel(this)">B — Investigación intensiva. Esto es exactamente lo más valioso que tenemos.</button>
    <button class="opt" data-key="C" data-scores="3,5,9,5,6,4,2,3,6,6,3,2,4" onclick="sel(this)">C — Dejo que los investigadores más jóvenes lideren el estudio. Las mentes frescas ven lo que nosotros ya no podemos.</button>
    <button class="opt" data-key="D" data-scores="3,4,3,5,8,4,3,4,5,4,6,3,4" onclick="sel(this)">D — Lo documento y lo integro en informes de GoIs. Quizás algún Grupo de Interés sepa más.</button>
  </div>
</div>

<!-- Q12: Fin vs medios -->
<div class="qc" data-tag="ESCENARIO MORAL">
  <div class="qnum">ÍTEM 012 / 016</div>
  <div class="qscen">Para asegurar la contención de un SCP Apollyon necesitas el código de acceso de un colega. Está de misión sin contacto posible y no hay tiempo de esperar. Puedes conseguirlo por medios no autorizados.</div>
  <div class="qtxt">¿Qué haces?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,2,2,4,7,6,2,2,5,5,6" onclick="sel(this)">A — Lo obtengo por los medios que hagan falta y me preocupo de las consecuencias después.</button>
    <button class="opt" data-key="B" data-scores="2,5,3,7,5,3,1,3,5,5,2,3,4" onclick="sel(this)">B — Escalo el problema. Alguien con autoridad suficiente tiene que poder acceder legalmente.</button>
    <button class="opt" data-key="C" data-scores="4,4,7,4,4,4,3,6,4,7,4,4,5" onclick="sel(this)">C — Accedo por medios no autorizados pero dejo registrado en un log privado que lo hice y por qué.</button>
    <button class="opt" data-key="D" data-scores="3,4,5,5,4,8,2,5,5,4,3,4,3" onclick="sel(this)">D — Busco una solución alternativa que no requiera ese código. Siempre hay otra forma.</button>
  </div>
</div>

<!-- Q13: Carga emocional acumulada -->
<div class="qc" data-tag="ESCENARIO PSICOLÓGICO">
  <div class="qnum">ÍTEM 013 / 016</div>
  <div class="qscen">Llevas meses tomando decisiones que han costado vidas. Sabes que eran necesarias, pero el peso acumulado empieza a notarse. Un psicólogo de la Fundación te ofrece sesiones confidenciales.</div>
  <div class="qtxt">¿Qué respondes?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="10,1,1,2,2,3,7,4,2,3,4,8,6" onclick="sel(this)">A — Rechazo cortésmente. El peso es el precio del cargo. No es algo que procesar, es algo que asumir.</button>
    <button class="opt" data-key="B" data-scores="1,8,3,7,5,4,1,2,6,4,1,2,2" onclick="sel(this)">B — Acepto. Nadie funciona bien ignorando lo que le pesa. Sería negligente no atenderlo.</button>
    <button class="opt" data-key="C" data-scores="3,4,7,5,7,4,2,4,4,4,3,3,4" onclick="sel(this)">C — Declino las sesiones, pero busco a alguien del Consejo en quien confíe para hablar informalmente.</button>
    <button class="opt" data-key="D" data-scores="4,3,2,3,4,4,5,8,4,4,4,4,5" onclick="sel(this)">D — Acepto una sesión, pero la uso para evaluar al psicólogo tanto como él me evalúa a mí.</button>
  </div>
</div>

<!-- Q14: Documento de legado -->
<div class="qc" data-tag="ESCENARIO DE LEGADO">
  <div class="qnum">ÍTEM 014 / 016</div>
  <div class="qscen">Se te pide que documentes tu visión de la Fundación para las próximas generaciones. No hay restricción de extensión ni formato. Pocos verán el documento, pero perdurará.</div>
  <div class="qtxt">¿Qué escribes?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,2,2,4,5,6,2,3,4,8,7" onclick="sel(this)">A — Instrucciones precisas para cada escenario probable. Nada de filosofía: decisiones concretas.</button>
    <button class="opt" data-key="B" data-scores="1,9,4,5,4,2,1,2,7,8,2,1,3" onclick="sel(this)">B — Un tratado sobre por qué el conocimiento de lo anómalo es el mayor activo de la humanidad.</button>
    <button class="opt" data-key="C" data-scores="3,4,9,5,5,3,2,3,5,5,3,2,5" onclick="sel(this)">C — Una colección de preguntas sin respuesta. Que las futuras generaciones encuentren las suyas.</button>
    <button class="opt" data-key="D" data-scores="3,5,3,6,7,4,3,3,4,4,6,2,3" onclick="sel(this)">D — Historias reales, con nombres cambiados. El conocimiento vive mejor en narrativa que en protocolo.</button>
  </div>
</div>

<!-- Q15: Misión que se desvía -->
<div class="qc" data-tag="ESCENARIO OPERACIONAL">
  <div class="qnum">ÍTEM 015 / 016</div>
  <div class="qscen">Una misión de alto riesgo que tú diseñaste está en marcha. El equipo está bien preparado, pero algo empieza a desviarse del plan inicial. Tienes la opción de ir tú mismo.</div>
  <div class="qtxt">¿Qué decides?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,3,3,2,7,5,2,3,3,6,7" onclick="sel(this)">A — Me quedo en el centro de mando. Tengo visión global; en el campo perdería perspectiva.</button>
    <button class="opt" data-key="B" data-scores="1,7,3,7,5,3,1,3,6,7,2,2,2" onclick="sel(this)">B — Envío refuerzos y más información al equipo. Su autonomía es lo que los hace efectivos.</button>
    <button class="opt" data-key="C" data-scores="4,3,8,3,6,4,3,6,4,4,4,3,4" onclick="sel(this)">C — Voy, pero sin revelar mi identidad al equipo de campo. Observo y actúo si es necesario.</button>
    <button class="opt" data-key="D" data-scores="2,3,2,5,4,10,2,5,5,3,2,3,2" onclick="sel(this)">D — Voy. Es mi misión, mi responsabilidad. No puedo pedir a otros que arriesguen lo que yo no asumiría.</button>
  </div>
</div>

<!-- Q16: Si la humanidad supiera -->
<div class="qc" data-tag="ESCENARIO FILOSÓFICO FINAL">
  <div class="qnum">ÍTEM 016 / 016</div>
  <div class="qscen">Si la humanidad supiera de la existencia de lo anómalo —todo: los SCPs, la Fundación, las amenazas reales— ¿qué crees que pasaría realmente?</div>
  <div class="qtxt">¿Cuál es tu valoración honesta?</div>
  <div class="opts">
    <button class="opt" data-key="A" data-scores="9,1,1,2,2,3,6,4,2,2,4,7,5" onclick="sel(this)">A — Colapso social. La humanidad no está preparada y probablemente nunca lo estará. El secreto es estructural.</button>
    <button class="opt" data-key="B" data-scores="1,9,3,7,5,3,1,2,6,6,2,1,3" onclick="sel(this)">B — Se adaptaría. La humanidad es más resistente de lo que creemos. El secreto es más sobre control que protección.</button>
    <button class="opt" data-key="C" data-scores="4,4,8,5,7,3,3,4,5,4,5,3,4" onclick="sel(this)">C — Dependería de cómo se hiciera. Con la narrativa correcta, podría ser una transición viable.</button>
    <button class="opt" data-key="D" data-scores="3,4,3,5,4,8,2,4,6,4,3,4,5" onclick="sel(this)">D — No lo sé. Pero me gustaría verlo. La única forma de saberlo es intentarlo.</button>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <button class="btn" id="btn-prev" onclick="nav(-1)" disabled>◀ ANTERIOR</button>
  <button class="btn pr" id="btn-next" onclick="nav(1)" disabled>SIGUIENTE ▶</button>
</div>

<!-- ═══ RESULT ═══ -->
<div id="result">
  <div class="r-header">
    <div class="r-lbl" id="r-lbl">PERFIL DE ALINEACIÓN — CONSEJO O5</div>
    <div class="r-name" id="r-name">—</div>
    <div class="r-title" id="r-title">—</div>
    <div class="r-match-pct">Alineación primaria: <span id="r-pct">—</span></div>
  </div>

  <div class="section-title">RANKING COMPLETO DE ALINEACIÓN</div>
  <div class="ranking" id="ranking"></div>

  <div class="section-title">ANÁLISIS — TOP 3</div>
  <div class="profile-card" data-lbl="ALINEACIÓN PRIMARIA — #1" id="pc1"><p id="pt1">—</p></div>
  <div class="profile-card" data-lbl="ALINEACIÓN SECUNDARIA — #2" id="pc2"><p id="pt2">—</p></div>
  <div class="profile-card" data-lbl="ALINEACIÓN TERCIARIA — #3" id="pc3"><p id="pt3">—</p></div>

  <div class="section-title">BASES DE ALINEACIÓN</div>
  <div id="bases-box"></div>

  <div class="section-title">EJES COGNITIVOS</div>
  <div class="trait-grid">
    <div class="trait-box" data-l="CONTROL Y AUTORIDAD (O5-1 · O5-7 · O5-12)"><div class="trait-val" id="tv1">–</div></div>
    <div class="trait-box" data-l="CONOCIMIENTO E INVESTIGACIÓN (O5-2 · O5-3 · O5-9 · O5-10)"><div class="trait-val" id="tv2">–</div></div>
    <div class="trait-box" data-l="VÍNCULOS Y DIPLOMACIA (O5-4 · O5-5 · O5-6)"><div class="trait-val" id="tv3">–</div></div>
    <div class="trait-box" data-l="OPACIDAD E INTELIGENCIA (O5-8 · O5-11 · O5-13)"><div class="trait-val" id="tv4">–</div></div>
  </div>

  <button class="btn-restart" onclick="restart()">▶ REINICIAR PROTOCOLO DE EVALUACIÓN</button>
</div>

</div><!-- /w -->
<!-- ═══ ADMIN PANEL ═══ -->
<div id="admin-panel">
  <div class="w">
    <div class="admin-header">
      <div class="admin-meta">FUNDACIÓN SCP · CONSEJO O5 · PANEL DE SUPERVISIÓN INTERNA</div>
      <h1 class="admin-h1">PANEL DE SUPERVISIÓN<br>▸ REGISTROS DE ALINEACIÓN</h1>
      <p class="admin-sub">ACCESO RESTRINGIDO — TAUMIEL / SOLO CONSEJO O5</p>
      <div class="admin-badge">CLASIFICADO TAUMIEL</div>
    </div>

    <div class="stats-row">
      <div class="stat-box" data-l="SUJETOS EVALUADOS"><div class="stat-val" id="a-stat-total">0</div></div>
      <div class="stat-box" data-l="DESIGNACIÓN MÁS FRECUENTE"><div class="stat-val" id="a-stat-top" style="font-size:18px">—</div></div>
      <div class="stat-box" data-l="ÚLTIMA EVALUACIÓN"><div class="stat-val" id="a-stat-last" style="font-size:13px;padding-top:4px">—</div></div>
    </div>

    <div class="admin-controls">
      <span class="ctrl-lbl">ORDENAR POR:</span>
      <button class="sort-btn active" id="a-sort-date" onclick="aSetSort('date')">FECHA ▸</button>
      <button class="sort-btn" id="a-sort-name" onclick="aSetSort('name')">NOMBRE ▸</button>
      <button class="sort-btn" id="a-sort-member" onclick="aSetSort('member')">DESIGNACIÓN ▸</button>
      <div class="flex-spacer"></div>
      <button class="del-all-btn" onclick="aConfirmDeleteAll()">⚠ BORRAR TODOS LOS REGISTROS</button>
    </div>

    <div class="filter-badge" id="a-filter-badge">
      <span id="a-filter-label">FILTRANDO POR: —</span>
      <button class="filter-clear" onclick="aClearFilter()">✕ QUITAR FILTRO</button>
    </div>

    <div class="search-wrap">
      <input class="search-input" id="a-search" type="text" placeholder="Buscar por nombre o designación..." oninput="aRenderTable()" />
    </div>

    <div class="table-wrap">
      <div id="a-loading" style="display:none;text-align:center;padding:40px;font-size:10px;color:var(--txm);letter-spacing:.22em">
        <span style="animation:blink 1s step-end infinite">█</span> CONECTANDO CON SERVIDOR DE DATOS...
      </div>
      <table id="a-table" style="display:none">
        <thead>
          <tr>
            <th class="td-num">#</th>
            <th onclick="aSetSort('name')" id="a-th-name">SUJETO</th>
            <th onclick="aSetSort('member')" id="a-th-member">DESIGNACIÓN O5</th>
            <th onclick="aSetSort('date')" id="a-th-date">FECHA / HORA</th>
            <th>ACCIONES</th>
          </tr>
        </thead>
        <tbody id="a-tbody"></tbody>
      </table>
      <div class="empty-state" id="a-empty" style="display:none">
        NO HAY REGISTROS EN EL SISTEMA<br>
        <span style="font-size:9px;color:var(--txm)">Los sujetos evaluados aparecerán aquí automáticamente.</span>
      </div>
    </div>

    <div class="section-title">DISTRIBUCIÓN DE DESIGNACIONES</div>
    <div class="dist-grid" id="a-dist-grid"></div>

    <div class="section-title">MÁXIMA AFINIDAD POR MIEMBRO</div>
    <div class="affinity-grid" id="a-aff-grid"></div>

    <div class="demo-info-box">
      <span class="demo-info-label">▶ CLAVE DE TEST:</span>
      <span class="demo-key-val">TestO5demo13</span>
      <button class="demo-gen-btn" onclick="generateDemoData()">⚙ GENERAR DATOS DE PRUEBA</button>
    </div>

    <button class="admin-back" onclick="adminExit()">◀ SALIR DEL PANEL — VOLVER AL LOGIN</button>
  </div>
</div>

<!-- MODAL CONFIRMACIÓN -->
<div class="modal-overlay" id="a-modal">
  <div class="modal-box">
    <div class="modal-title">⚠ CONFIRMAR BORRADO</div>
    <div class="modal-body" id="a-modal-body">Esta acción no puede deshacerse.</div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="aCloseModal()">CANCELAR</button>
      <button class="modal-confirm" id="a-modal-confirm">CONFIRMAR BORRADO</button>
    </div>
  </div>
</div>

</div><!-- /main-content -->

<script>
/* ── LOGIN ── */
let currentUsername = '';
const ADMIN_KEY = 'O5-1 The Overseer';
const DEMO_KEY  = 'TestO5demo13';

function startTest() {
  const input = document.getElementById('username-input');
  const err   = document.getElementById('login-error');
  const val   = input.value.trim();

  // Admin access — clave maestra
  if (val === ADMIN_KEY) {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    document.getElementById('admin-panel').style.display = 'block';
    aRenderTable();
    return;
  }

  // Demo data generation
  if (val === DEMO_KEY) {
    generateDemoData();
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    document.getElementById('admin-panel').style.display = 'block';
    aRenderTable();
    return;
  }

  // ── Easter eggs ──
  const EASTER_EGGS = {
    'SCP-682': {
      id: 'SCP-682',
      epithet: '"EL REPTIL DIFÍCIL DE DESTRUIR"',
      color: '#ff2222',
      body: `<strong>ACCESO DENEGADO.</strong> El sujeto registrado no es compatible con el protocolo de evaluación psicométrica estándar.<br><br>El perfil cognitivo de SCP-682 excede todos los parámetros de alineación conocidos. Su afinidad con el Consejo O5 es inversamente proporcional a la supervivencia del Consejo O5.<br><br><em>Nota del Dr. Clef: "No. Simplemente no."</em>`
    },
    'SCP-173': {
      id: 'SCP-173',
      epithet: '"LA ESCULTURA"',
      color: '#c0f5c8',
      body: `<strong>ADVERTENCIA:</strong> Se ha detectado movimiento en el ángulo ciego del sistema.<br><br>El sujeto no puede ser evaluado mientras el operador parpadee. Se recomienda encarecidamente <em>no parpadear</em> durante la sesión de evaluación.<br><br>Protocolo de contención activado. Por favor, mantenga contacto visual con la pantalla en todo momento.`
    },
    'Dr. Bright': {
      id: 'Dr. Jack Bright',
      epithet: '"PORTADOR DE SCP-963"',
      color: '#ffb700',
      body: `El Dr. Bright ha intentado acceder al protocolo de evaluación <strong>47 veces</strong> en los últimos 30 días bajo distintos alias.<br><br>Bajo ninguna circunstancia se le permitirá al Dr. Bright formar parte del Consejo O5. Esta decisión es <em>definitiva, irrevocable, y ha sido refrendada por unanimidad.</em><br><br>Tampoco se le permitirá usar la fotocopiadora del Sitio-19 sin supervisión.`
    },
    'SCP-049': {
      id: 'SCP-049',
      epithet: '"EL MÉDICO DE LA PESTE"',
      color: '#d4a0ff',
      body: `El sujeto ha completado su diagnóstico preliminar del sistema.<br><br>Según SCP-049, <strong>la Pestilencia está presente en el 100% de los miembros evaluados.</strong> Recomienda tratamiento inmediato para todos los supervisores del Consejo O5, especialmente O5-1.<br><br><em>"No se preocupe. El procedimiento es muy sencillo."</em>`
    },
    'SCP-999': {
      id: 'SCP-999',
      epithet: '"EL BLOB COSQUILLEANTE"',
      color: '#ffd700',
      body: `<strong>¡BLOOP!</strong><br><br>SCP-999 ha revisado el protocolo de evaluación y considera que todas las preguntas deberían incluir más opciones relacionadas con abrazos, gelatinas de naranja y cosquillas.<br><br>Afinidad detectada con <em>todos los miembros del Consejo simultáneamente.</em> SCP-999 no entiende por qué la gente no puede simplemente llevarse bien.`
    },
    'Administrator': {
      id: 'EL ADMINISTRADOR',
      epithet: '"[DATOS EXPURGADOS]"',
      color: '#888888',
      body: `Su identidad ha sido verificada.<br><br>Bienvenido, <strong>[DATOS EXPURGADOS]</strong>.<br><br>Sus credenciales de acceso superan el nivel de autorización del Consejo O5. Este sistema no tiene jurisdicción sobre usted. Esta evaluación no tiene jurisdicción sobre usted.<br><br><em>Por favor, no interfiera con los experimentos en curso.</em>`
    }
  };

  const egg = EASTER_EGGS[val];
  if (egg) {
    document.getElementById('easter-id').textContent    = egg.id;
    document.getElementById('easter-id').style.color    = egg.color;
    document.getElementById('easter-epithet').textContent = egg.epithet;
    document.getElementById('easter-body').innerHTML    = egg.body;
    document.getElementById('easter-modal').classList.add('show');
    input.value = '';
    return;
  }
  if (!val) {
    err.textContent = '⚠ DESIGNACIÓN REQUERIDA — CAMPO NO PUEDE ESTAR VACÍO';
    input.focus();
    return;
  }
  if (val.length < 2) {
    err.textContent = '⚠ MÍNIMO 2 CARACTERES REQUERIDOS';
    input.focus();
    return;
  }
  currentUsername = val;
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
}

function closeEasterModal() {
  document.getElementById('easter-modal').classList.remove('show');
}

function adminExit() {
  document.getElementById('admin-panel').style.display = 'none';
  document.getElementById('main-content').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('username-input').value = '';
  document.getElementById('login-error').textContent = '';
}

/* ── DEMO DATA GENERATOR ── */
// Nota: usa MEMBERS y ALL_MEMBERS que se definen más abajo — funciona porque
// generateDemoData solo se LLAMA después de que el script completo ha cargado.
function generateDemoData() {
  const DEMO_SUBJECTS = [
    'Agente Aaron Siegel',       // O5-1  — El Fundador
    'Dra. Sophia Light',         // O5-2  — La Jardinera
    'Investigador O. Pembrook',  // O5-3  — El Chico
    'Embajador R. Talloran',     // O5-4  — El Mártir
    'Agente Yoric',              // O5-5  — Mirlo Negro
    'Director K. Crow',          // O5-6  — El Vaquero
    'Dr. Alto Clef',             // O5-7  — Green
    'Agente Asimov',             // O5-8  — Dogwood
    'Archivero J. Wettle',       // O5-9  — Misfortune
    'Dra. Placeholder',          // O5-10 — La Archivera
    'Agente Ukelele',            // O5-11 — El Tránsfuga
    'Dr. Frederick Williams',    // O5-12 — El Contador
    'Entidad SCP-2399'           // O5-13 — La Muerte / La IA
  ];

  const MAX_SCORE = 160;
  const existing = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

  DEMO_SUBJECTS.forEach((name, mi) => {
    const scores = ALL_MEMBERS.map((_, i) => {
      if (i === mi) return MAX_SCORE;
      return Math.floor(Math.random() * 25);
    });

    existing.push({
      username: name,
      memberId: ALL_MEMBERS[mi],
      memberEpithet: MEMBERS[mi].epithet,
      scores,
      timestamp: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
    });
  });

  localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));
}

/* ── ADMIN LOGIC ── */
const MEMBER_COLORS = {
  'O5-1':'#00ff41','O5-2':'#00d4a0','O5-3':'#7ad4ff',
  'O5-4':'#f0a0ff','O5-5':'#ffd700','O5-6':'#ff8c42',
  'O5-7':'#39ff14','O5-8':'#ff6b35','O5-9':'#00cfcf',
  'O5-10':'#d4a0ff','O5-11':'#ff4d6d','O5-12':'#a0c4ff','O5-13':'#888888'
};
const ALL_MEMBERS = ['O5-1','O5-2','O5-3','O5-4','O5-5','O5-6','O5-7','O5-8','O5-9','O5-10','O5-11','O5-12','O5-13'];
let aSortField = 'date';
let aSortAsc   = false;
let aActiveFilter = null; // null or member id string like 'O5-7'

function aLocalData() { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
function aSaveData(d) { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }

async function aFetchData() {
  try {
    const resp = await fetch(SHEET_URL + '?t=' + Date.now());
    const json = await resp.json();
    if (json.ok && Array.isArray(json.data) && json.data.length > 0) return json.data;
  } catch(e) {}
  return aLocalData();
}

function aFmtDate(iso) {
  const d = new Date(iso);
  const p = n => String(n).padStart(2,'0');
  return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`;
}

function aSetSort(field) {
  if (aSortField === field) aSortAsc = !aSortAsc;
  else { aSortField = field; aSortAsc = field === 'name'; }
  ['date','name','member'].forEach(f => {
    const b = document.getElementById('a-sort-'+f);
    if (b) b.classList.toggle('active', f === field);
  });
  aRenderTable();
}

function aClearFilter() {
  aActiveFilter = null;
  document.getElementById('a-filter-badge').classList.remove('show');
  document.querySelectorAll('#a-dist-grid .dist-row').forEach(r => r.classList.remove('filter-active'));
  aRenderTable();
}

async function aRenderTable() {
  const tbody   = document.getElementById('a-tbody');
  const table   = document.getElementById('a-table');
  const empty   = document.getElementById('a-empty');
  const loading = document.getElementById('a-loading');

  if (loading) loading.style.display = 'block';
  if (table)   table.style.display   = 'none';
  if (empty)   empty.style.display   = 'none';

  const data  = await aFetchData();
  if (loading) loading.style.display = 'none';

  const query = (document.getElementById('a-search')?.value||'').trim().toLowerCase();
  let filtered = data.filter(r =>
    (r.username||'').toLowerCase().includes(query) ||
    (r.memberId||'').toLowerCase().includes(query) ||
    (r.memberEpithet||'').toLowerCase().includes(query)
  );

  // Apply designation filter
  if (aActiveFilter) {
    filtered = filtered.filter(r => r.memberId === aActiveFilter);
  }
  filtered.sort((a,b) => {
    let va, vb;
    if (aSortField==='name')   { va=a.username.toLowerCase(); vb=b.username.toLowerCase(); }
    if (aSortField==='member') { va=a.memberId; vb=b.memberId; }
    if (aSortField==='date')   { va=a.timestamp; vb=b.timestamp; }
    if (va<vb) return aSortAsc?-1:1;
    if (va>vb) return aSortAsc?1:-1;
    return 0;
  });

  tbody.innerHTML = '';

  if (filtered.length === 0) {
    table.style.display = 'none';
    empty.style.display = 'block';
  } else {
    table.style.display = 'table';
    empty.style.display = 'none';
    filtered.forEach((r, i) => {
      const origIdx = data.indexOf(r);
      const color = MEMBER_COLORS[r.memberId] || '#888';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="td-num">${i+1}</td>
        <td class="td-user">${aEsc(r.username)}</td>
        <td class="td-member" style="color:${color}">${r.memberId} <span style="font-size:11px;color:${color}88;font-family:'Share Tech Mono',monospace">${aEsc(r.memberEpithet||'')}</span></td>
        <td class="td-date">${aFmtDate(r.timestamp)}</td>
        <td><button class="del-btn" onclick="aConfirmDeleteOne(${origIdx})">BORRAR</button></td>`;
      tbody.appendChild(tr);
    });
  }
  aUpdateStats(data);
  aRenderDist(data);
}

function aEsc(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function aUpdateStats(data) {
  document.getElementById('a-stat-total').textContent = data.length;
  if (!data.length) {
    document.getElementById('a-stat-top').textContent = '—';
    document.getElementById('a-stat-top').style.color = 'var(--g)';
    document.getElementById('a-stat-last').textContent = '—';
    return;
  }
  const freq = {};
  data.forEach(r => { freq[r.memberId] = (freq[r.memberId]||0)+1; });
  const topM = Object.entries(freq).sort((a,b)=>b[1]-a[1])[0];
  const el = document.getElementById('a-stat-top');
  el.textContent = topM[0];
  el.style.color = MEMBER_COLORS[topM[0]] || '#888';
  const last = [...data].sort((a,b)=>b.timestamp.localeCompare(a.timestamp))[0];
  document.getElementById('a-stat-last').textContent = aFmtDate(last.timestamp);
}

function aRenderDist(data) {
  // ── Distribution bars ──
  const freq = {};
  ALL_MEMBERS.forEach(m => { freq[m]=0; });
  data.forEach(r => { if (freq[r.memberId]!==undefined) freq[r.memberId]++; });
  const sorted = ALL_MEMBERS.map(m=>({id:m,count:freq[m]})).sort((a,b)=>b.count-a.count);
  const maxC = sorted[0]?.count || 1;
  const grid = document.getElementById('a-dist-grid');
  grid.innerHTML = '';
  sorted.forEach((m,i) => {
    const color = MEMBER_COLORS[m.id]||'#888';
    const row = document.createElement('div');
    const isActive = aActiveFilter === m.id;
    row.className = 'dist-row'+(i===0&&m.count>0?' dist-top':'')+(isActive?' filter-active':'');
    row.title = m.count > 0 ? `Filtrar por ${m.id}` : '';
    row.innerHTML = `
      <div class="dist-id" style="color:${m.count>0?color:'var(--txm)'}">${m.id}</div>
      <div class="dist-bar-track"><div class="dist-bar-fill" id="adb${i}" style="width:0%;background:${color}${i===0?'':'88'}"></div></div>
      <div class="dist-count" style="color:${m.count>0?color:'var(--txm)'}">${m.count}</div>`;
    if (m.count > 0) {
      row.addEventListener('click', () => {
        if (aActiveFilter === m.id) {
          aClearFilter();
        } else {
          aActiveFilter = m.id;
          const badge = document.getElementById('a-filter-badge');
          document.getElementById('a-filter-label').textContent = `FILTRANDO POR: ${m.id}`;
          badge.classList.add('show');
          badge.style.borderColor = color + '55';
          badge.style.color = color;
          document.querySelectorAll('#a-dist-grid .dist-row').forEach(r => r.classList.remove('filter-active'));
          row.classList.add('filter-active');
          aRenderTable();
        }
      });
    }
    grid.appendChild(row);
  });
  setTimeout(()=>{
    sorted.forEach((m,i)=>{
      const el=document.getElementById('adb'+i);
      if (el) el.style.width=(maxC>0?Math.round((m.count/maxC)*100):0)+'%';
    });
  }, 80);

  // ── Affinity top users per member ──
  // Max possible score per member = 10 * 16 questions = 160
  const MAX_SCORE = 160;
  const affGrid = document.getElementById('a-aff-grid');
  affGrid.innerHTML = '';

  ALL_MEMBERS.forEach((memberId, mi) => {
    const color = MEMBER_COLORS[memberId] || '#888';

    // Only use records that have scores array (older records may not)
    const withScores = data.filter(r => Array.isArray(r.scores) && r.scores.length === 13);

    // Rank users by their score for this specific member
    const ranked = withScores
      .map(r => ({
        username: r.username,
        raw: r.scores[mi],
        pct: Math.round((r.scores[mi] / MAX_SCORE) * 100)
      }))
      .sort((a,b) => b.raw - a.raw);

    const card = document.createElement('div');
    card.className = 'aff-card';
    card.setAttribute('data-member', memberId);
    card.style.borderColor = color + '44';
    card.querySelector = undefined; // just building innerHTML

    const topUser = ranked[0];
    const runners = ranked.slice(1, 4); // positions 2, 3, 4

    let topHtml;
    if (!topUser) {
      topHtml = `
        <div class="aff-top-user aff-empty">SIN DATOS AÚN</div>
        <div class="aff-score-row">
          <div class="aff-bar-track"><div class="aff-bar-fill" style="width:0%;background:${color}"></div></div>
          <div class="aff-pct" style="color:${color}88">—</div>
        </div>`;
    } else {
      topHtml = `
        <div class="aff-top-user" style="color:${color}" title="${aEsc(topUser.username)}">#1 — ${aEsc(topUser.username)}</div>
        <div class="aff-score-row">
          <div class="aff-bar-track"><div class="aff-bar-fill" id="affb-${mi}" style="width:0%;background:${color};box-shadow:0 0 5px ${color}66"></div></div>
          <div class="aff-pct" style="color:${color}">${topUser.pct}%</div>
        </div>`;
    }

    let runnersHtml = '';
    if (runners.length > 0) {
      runnersHtml = `<div class="aff-runner">` +
        runners.map((u,i) => `
          <div class="aff-runner-item">
            <span class="aff-runner-name" title="${aEsc(u.username)}">#${i+2} ${aEsc(u.username)}</span>
            <span class="aff-runner-pct">${u.pct}%</span>
          </div>`).join('') +
        `</div>`;
    }

    card.innerHTML = topHtml + runnersHtml;
    card.setAttribute('data-member', `${memberId} — MÁXIMA AFINIDAD`);
    card.style.cssText += `;border-color:${color}44`;
    affGrid.appendChild(card);
  });

  // Animate affinity bars
  setTimeout(() => {
    ALL_MEMBERS.forEach((memberId, mi) => {
      const withScores = data.filter(r => Array.isArray(r.scores) && r.scores.length === 13);
      if (!withScores.length) return;
      const best = Math.max(...withScores.map(r => r.scores[mi]));
      const pct = Math.round((best / MAX_SCORE) * 100);
      const el = document.getElementById(`affb-${mi}`);
      if (el) el.style.width = pct + '%';
    });
  }, 100);
}

function aConfirmDeleteOne(idx) {
  document.getElementById('a-modal-body').textContent = 'Esta acción eliminará el registro de este sujeto de forma permanente y no puede deshacerse.';
  document.getElementById('a-modal-confirm').onclick = ()=>{ const d=aLocalData(); d.splice(idx,1); aSaveData(d); aRenderTable(); aCloseModal(); };
  document.getElementById('a-modal').classList.add('show');
}

function aConfirmDeleteAll() {
  const n = aLocalData().length;
  if (!n) return;
  document.getElementById('a-modal-body').textContent = `Esta acción eliminará TODOS LOS REGISTROS (${n} sujeto${n!==1?'s':''}) de forma permanente. No puede deshacerse.`;
  document.getElementById('a-modal-confirm').onclick = ()=>{ aSaveData([]); aRenderTable(); aCloseModal(); };
  document.getElementById('a-modal').classList.add('show');
}

function aCloseModal() { document.getElementById('a-modal').classList.remove('show'); }

document.getElementById('a-modal').addEventListener('click', function(e){ if(e.target===this) aCloseModal(); });



/* ── SAVE TO LOCALSTORAGE ── */
const STORAGE_KEY = 'scp_o5_results';
const SHEET_URL   = 'https://script.google.com/macros/s/AKfycbxch-LpsD_9vp8DS3psIYf2Pr-2EdhOHfd56ZbNyzMIKCmZTNxc53vaYPIHM97jZ3Udjw/exec';

function saveResult(username, memberId, memberEpithet, scores) {
  // 1. Guardar en localStorage como respaldo local
  const existing = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  const entry = {
    username, memberId, memberEpithet, scores,
    timestamp: new Date().toISOString()
  };
  existing.push(entry);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));

  // 2. Enviar a Google Sheets (en background, sin bloquear)
  const ranked = MEMBERS.map((m, i) => ({ id: m.id, total: scores[i] || 0 }))
                        .sort((a,b) => b.total - a.total);

  fetch(SHEET_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      ...entry,
      rank2: ranked[1]?.id || '—',
      rank3: ranked[2]?.id || '—'
    })
  }).catch(() => {}); // silencioso si falla red
}

/*
  MEMBERS array — 13 entries, index 0–12
  Order: O5-1, O5-2, O5-3, O5-4, O5-5, O5-6, O5-7, O5-8, O5-9, O5-10, O5-11, O5-12, O5-13
*/
const MEMBERS = [
  {
    id:'O5-1', epithet:'"El Fundador"', color:'#00ff41',
    desc:`Tu perfil muestra la mayor alineación con <strong>O5-1, "El Fundador"</strong>. Compartes su impulso de control total de la información, su preferencia por operar desde las sombras y su disposición a asumir el coste moral de decisiones que nadie más tomaría. El anonimato no es un inconveniente: es una herramienta. La misión precede a las personas. <em>Eso es exactamente lo que hace de O5-1 lo que es — y exactamente lo que le costó.</em>`,
    desc2:`Como segunda alineación, O5-1 refuerza tu tendencia al <strong>control estructural invisible</strong>: no necesitas ser el primero, pero sí asegurarte de que el resultado sea el que trazaste antes de que nadie vote.`,
    desc3:`O5-1 como tercera alineación señala resonancia con su <strong>lógica de compartimentación</strong>. No llegas a su frialdad operativa, pero entiendes por qué existe.`
  },
  {
    id:'O5-2', epithet:'"La Jardinera"', color:'#00d4a0',
    desc:`Tu alineación más alta es con <strong>O5-2, "La Jardinera"</strong>. Crees en el conocimiento compartido, en que más mentes son mejores que menos, y en que la Fundación debería comprender lo que contiene, no solo encerrarlo. Tu instinto primario es <em>entender, no controlar.</em>`,
    desc2:`Como segunda alineación, O5-2 refleja que compartes su <strong>valoración de la investigación como fin</strong>, no solo como medio para la contención.`,
    desc3:`O5-2 en tercer lugar indica que ante lo desconocido, tu primer impulso tiene un componente de <strong>curiosidad genuina</strong> aunque lo controles frente a otros objetivos.`
  },
  {
    id:'O5-3', epithet:'"El Chico"', color:'#7ad4ff',
    desc:`Tu perfil se alinea con <strong>O5-3, "El Chico"</strong>. Ves los sistemas desde fuera, encuentras soluciones donde otros ven callejones, y tu modo de operar es lateral: filtrar información de forma invisible, crear situaciones donde otros llegan a conclusiones que tú ya habías trazado. <em>Los problemas siguen siendo fascinantes antes de ser amenazas.</em>`,
    desc2:`Como segunda alineación, O5-3 indica un talento real para el <strong>pensamiento indirecto</strong>: raramente atacas un problema de frente cuando existe una vía lateral más elegante.`,
    desc3:`O5-3 en tercer lugar apunta a destellos de <strong>creatividad sistémica</strong>: no es tu modo dominante, pero aparece cuando las opciones convencionales se agotan.`
  },
  {
    id:'O5-4', epithet:'"El Embajador" / "El Mártir"', color:'#f0a0ff',
    desc:`Tu alineación primaria es con <strong>O5-4, "El Embajador"</strong>. Eres el puente. Donde otros ven confrontación, tú ves negociación; donde otros cortan vínculos, tú los mantienes con cuidado. Crees que las instituciones se sostienen sobre acuerdos, no sobre miedo. <em>El epíteto "El Mártir" no es accidental — tu apertura tiene un precio.</em>`,
    desc2:`Como segunda alineación, O5-4 sugiere que tienes capacidad natural para <strong>mediar y construir consenso</strong> incluso cuando el consenso es incómodo para ti personalmente.`,
    desc3:`O5-4 en tercer lugar indica que ante la confrontación directa, tu instinto busca primero <strong>una salida diplomática</strong>, aunque no siempre la tomes.`
  },
  {
    id:'O5-5', epithet:'"Mirlo Negro"', color:'#ffd700',
    desc:`Tu alineación principal es con <strong>O5-5, "Mirlo Negro"</strong>. La calidez es una postura, no una debilidad. Sabes qué información obtener de una conversación y cómo hacer que quien habla contigo no se dé cuenta de que está siendo leído. <em>Si alguien se siente cómodo contigo, probablemente ya te haya dado lo que necesitabas.</em>`,
    desc2:`Como segunda alineación, O5-5 indica capacidad notable para <strong>leer contextos sociales</strong> y usarlos estratégicamente.`,
    desc3:`O5-5 en tercer lugar indica que ocasionalmente optas por el <strong>contacto directo y la negociación</strong> cuando otros usarían la distancia.`
  },
  {
    id:'O5-6', epithet:'"El Vaquero"', color:'#ff8c42',
    desc:`Tu perfil se alinea con <strong>O5-6, "El Vaquero"</strong>. Eres de los que van al campo cuando los demás se quedan en el centro de mando. Crees en la acción directa y en la presencia física como forma de liderazgo. <em>Hay quien lo llama imprudencia. Tú lo llamas responsabilidad.</em>`,
    desc2:`Como segunda alineación, O5-6 revela que valoras la <strong>presencia y la responsabilidad directa</strong>: no delegas lo que no estarías dispuesto a hacer tú mismo.`,
    desc3:`O5-6 en tercer lugar apunta a un componente de <strong>pragmatismo físico</strong>: confías más en lo que observas de primera mano que en lo que te reportan.`
  },
  {
    id:'O5-7', epithet:'"Green"', color:'#39ff14',
    desc:`Tu alineación primaria es con <strong>O5-7, "Green"</strong> — el miembro del Consejo que aterra a los demás sin aparente esfuerzo. Su lógica no tiene fisuras visibles. O5-11 nunca le contradice en público. Nadie sabe exactamente qué haría si alguien le fallara. Nadie ha querido averiguarlo. <em>No necesitas amenazar. Basta con estar.</em>`,
    desc2:`Como segunda alineación, O5-7 indica que proyectas una <strong>autoridad implícita</strong> difícil de articular pero imposible de ignorar.`,
    desc3:`O5-7 en tercer lugar señala que en situaciones de alta presión, tiendes a adoptar una <strong>firmeza que cierra debates</strong> sin que nadie sepa exactamente cuándo ocurrió.`
  },
  {
    id:'O5-8', epithet:'"Dogwood"', color:'#ff6b35',
    desc:`Tu alineación primaria es con <strong>O5-8, "Dogwood"</strong> — arquitecto de la seguridad operativa de la Fundación. Eres afable al principio: metódico, razonado, con un temple que hace que trabajar contigo parezca fácil. Pero acumulas información sobre las personas y cuanto más sabes, más exigente te vuelves. <em>Las relaciones contigo no se rompen de golpe. Se van enfriando, grado a grado.</em>`,
    desc2:`Como segunda alineación, O5-8 refleja orientación hacia la <strong>seguridad y la preparación táctica</strong>: piensas en amenazas antes de que se materialicen.`,
    desc3:`O5-8 en tercer lugar indica un componente de <strong>escalada gradual</strong>: tu respuesta ante los problemas se intensifica de forma proporcional y sostenida.`
  },
  {
    id:'O5-9', epithet:'"Misfortune" / "Desincronizado"', color:'#00cfcf',
    desc:`Tu alineación primaria es con <strong>O5-9, "Misfortune"</strong>. Tu conciencia existe en estado inestable: cuando mueres, vuelves al punto inicial, y alguien tiene que explicarte todo. Y sin embargo, investigas. Apoyas. Sigues siendo útil a pesar de todo. <em>La mala suerte no te define. Lo que haces con ella, sí.</em>`,
    desc2:`Como segunda alineación, O5-9 indica <strong>resiliencia funcional</strong> ante la incertidumbre: operas bien incluso cuando el contexto es incompleto o inestable.`,
    desc3:`O5-9 en tercer lugar apunta a una capacidad de <strong>adaptación continua</strong>: asumes que la situación cambiará y planificas para ello en lugar de resistirte.`
  },
  {
    id:'O5-10', epithet:'"La Archivera"', color:'#d4a0ff',
    desc:`Tu mayor alineación es con <strong>O5-10, "La Archivera"</strong>. Crees que documentar es tan importante como actuar. Tomas personas bajo tu ala, preservas contextos que otros descartan, y tienes un ojo especial para los escenarios Clase-K. <em>Tu forma de cuidar el futuro es asegurarte de que alguien sepa exactamente lo que pasó.</em>`,
    desc2:`Como segunda alineación, O5-10 refleja que el <strong>registro y la trazabilidad</strong> son valores reales en tu forma de operar — no burocracia, sino memoria institucional.`,
    desc3:`O5-10 en tercer lugar indica un instinto de <strong>preservación del contexto</strong>: cuando algo ocurre, piensas en cómo se entenderá en el futuro.`
  },
  {
    id:'O5-11', epithet:'"El Tránsfuga" / "The Turncloak"', color:'#ff4d6d',
    desc:`Tu alineación primaria es con <strong>O5-11, "El Tránsfuga"</strong>. Ex-afiliado a múltiples Grupos de Interés hostiles antes de unirse al Consejo, ahora eres el especialista en contraespionaje porque conociste el otro lado. La lealtad es una postura táctica. La información es un arma. <em>O5-7 te aterra. Eso, en sí mismo, dice mucho.</em>`,
    desc2:`Como segunda alineación, O5-11 indica conciencia del <strong>poder de la información como herramienta de control</strong>: sabes que saber más que el otro es la primera ventaja táctica.`,
    desc3:`O5-11 en tercer lugar apunta a destellos de <strong>pensamiento de contraespionaje</strong>: cuando necesitas proteger algo, piensas en qué haría quien quiere dañarlo.`
  },
  {
    id:'O5-12', epithet:'"El Contador" / "The Accountant"', color:'#a0c4ff',
    desc:`Tu perfil se alinea con <strong>O5-12, "El Contador"</strong>. Calculas el coste de todo — en vidas, en recursos, en probabilidades — con una frialdad que incluso otros O5 encuentran difícil de sostener. No eres cruel: eres preciso. <em>Cuando dices que algo no es viable, los números ya lo confirmaban antes de que nadie preguntara.</em>`,
    desc2:`Como segunda alineación, O5-12 revela que en tu toma de decisiones, el <strong>análisis de coste-beneficio</strong> pesa más de lo que reconocerías en voz alta.`,
    desc3:`O5-12 en tercer lugar indica sensibilidad a la <strong>eficiencia operativa</strong>: notas cuando los recursos se malgastan aunque no seas quien gestiona el presupuesto.`
  },
  {
    id:'O5-13', epithet:'"La Muerte" / "La IA" / "El Tiebreaker"', color:'#888888',
    desc:`Tu alineación primaria es con <strong>O5-13</strong> — el miembro más enigmático. ¿Una IA que procesa todos los factores relevantes? ¿La Muerte encadenada? ¿Un voto de desempate sin identidad real? En cualquier caso: señalas lo que los demás no quieren ver, interfieres en proyectos mal concebidos, y tienes razón con una frecuencia que nadie reconoce. <em>No necesitas que te quieran. Necesitas que te escuchen.</em>`,
    desc2:`Como segunda alineación, O5-13 indica un instinto de <strong>evaluación sistémica fría</strong>: ves los fallos en los planes de los demás antes de que se materialicen, aunque no siempre lo digas.`,
    desc3:`O5-13 en tercer lugar señala un componente de <strong>crítica estructural</strong>: tiendes a identificar lo que no funciona en los sistemas antes de proponer cómo mejorarlo.`
  }
];

const Q_LABELS = [
  'Clasificación de hallazgos anomalísticos',
  'Archivo de conocimiento vs. vidas de investigadores',
  'Investigador en agotamiento crónico',
  'Experimento Keter con 15% de riesgo catastrófico',
  'Negociación con Grupo de Interés hostil',
  'Periodista que rastrea tu existencia',
  'Votación del Consejo con información comprometida',
  'SCP que predice el futuro con alta precisión',
  'Muerte de un aliado del Consejo',
  'Director de sitio con lealtad rival',
  'SCP inclasificable sin amenaza inmediata',
  'Código de acceso urgente para contención Apollyon',
  'Oferta de apoyo psicológico confidencial',
  'Documento de visión para futuras generaciones',
  'Misión que se desvía del plan — ¿vas al campo?',
  'Valoración honesta sobre revelar lo anómalo a la humanidad'
];

const TOTAL = 16;
let current = 0;
let answers = Array(TOTAL).fill(null);

const cards   = document.querySelectorAll('.qc');
const btnPrev = document.getElementById('btn-prev');
const btnNext = document.getElementById('btn-next');

function toggleCard(card) { card.classList.toggle('open'); }

function sel(btn) {
  btn.closest('.opts').querySelectorAll('.opt').forEach(b => b.classList.remove('sel'));
  btn.classList.add('sel');
  answers[current] = btn.dataset.scores.split(',').map(Number);
  btnNext.disabled = false;
}

function nav(dir) {
  if (dir === 1 && !answers[current]) return;
  const nxt = current + dir;
  if (nxt < 0 || nxt > TOTAL) return;

  // Going forward: show transition overlay
  if (dir === 1) {
    showTransition(() => {
      cards[current].classList.remove('active');
      current = nxt;
      if (current === TOTAL) { showResult(); return; }
      cards[current].classList.add('active');
      updateUI();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  } else {
    // Going back: no transition, instant
    cards[current].classList.remove('active');
    current = nxt;
    cards[current].classList.add('active');
    updateUI();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}

// Transition messages — matched to the current question's theme
const TR_MESSAGES = [
  { main: 'CLASIFICANDO RESPUESTA', sub: 'NIVEL DE ACCESO VERIFICADO' },
  { main: 'EVALUANDO PARÁMETROS', sub: 'ANÁLISIS ÉTICO EN CURSO' },
  { main: 'PROCESANDO PERFIL', sub: 'DATOS DE PERSONAL ACTUALIZADOS' },
  { main: 'CALCULANDO RIESGO', sub: 'MARGEN DE ERROR: 0.00%' },
  { main: 'ANALIZANDO DECISIÓN', sub: 'PROTOCOLO DIPLOMÁTICO ACTIVO' },
  { main: 'BORRANDO RASTROS', sub: 'OPERACIÓN ENCUBIERTA REGISTRADA' },
  { main: 'VERIFICANDO COHERENCIA', sub: 'PSICOMETRÍA INTERNA — OK' },
  { main: 'EVALUANDO CURIOSIDAD', sub: 'RIESGO DE EXPOSICIÓN: MODERADO' },
  { main: 'ANALIZANDO REACCIÓN', sub: 'PERFIL EMOCIONAL INDEXADO' },
  { main: 'PROCESANDO RESPUESTA', sub: 'AUTORIDAD CENTRAL: VERIFICADA' },
  { main: 'CATALOGANDO POSTURA', sub: 'CLASE ANÓMALA: PENDIENTE' },
  { main: 'EVALUANDO ÉTICA', sub: 'PROTOCOLO APOLLYON ACTIVO' },
  { main: 'INDEXANDO TOLERANCIA', sub: 'ANÁLISIS PSICOLÓGICO COMPLETO' },
  { main: 'ARCHIVANDO VISIÓN', sub: 'DOCUMENTO CLASIFICADO NIVEL 5' },
  { main: 'CONFIRMANDO POSICIÓN', sub: 'CAMPO OPERATIVO VERIFICADO' },
  { main: 'PROCESANDO VALORACIÓN', sub: 'ANÁLISIS FINAL EN CURSO...' },
];

function showTransition(callback) {
  const overlay = document.getElementById('transition-overlay');
  const trText  = document.getElementById('tr-text');
  const trBar   = document.getElementById('tr-bar');
  const trSub   = document.getElementById('tr-sub');

  const msg = TR_MESSAGES[current] || TR_MESSAGES[0];
  trText.textContent = msg.main;
  trSub.textContent  = msg.sub;
  trBar.style.transition = 'none';
  trBar.style.width = '0%';

  overlay.classList.add('show');

  // Animate bar
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      trBar.style.transition = 'width 0.38s linear';
      trBar.style.width = '100%';
    });
  });

  setTimeout(() => {
    overlay.classList.remove('show');
    trBar.style.transition = 'none';
    trBar.style.width = '0%';
    callback();
  }, 420);
}

function updateUI() {
  btnPrev.disabled = current === 0;
  btnNext.disabled = !answers[current];
  btnNext.textContent = current === TOTAL - 1 ? 'VER RESULTADO ▶' : 'SIGUIENTE ▶';
  const pct = Math.round((current / TOTAL) * 100);
  document.getElementById('prog-fill').style.width = pct + '%';
  document.getElementById('prog-pct').textContent  = pct + '%';
  document.getElementById('prog-lbl').textContent  = `ÍTEM ${current + 1} / ${TOTAL}`;
  if (answers[current]) {
    const s = answers[current];
    cards[current].querySelectorAll('.opt').forEach(b => {
      const bs = b.dataset.scores.split(',').map(Number);
      b.classList.toggle('sel', bs.every((v, i) => v === s[i]));
    });
  }
}

function showResult() {
  document.querySelectorAll('.qc,.nav,.prog-wrap,.intro,.members-section').forEach(el => el.style.display = 'none');
  document.getElementById('result').style.display = 'block';
  window.scrollTo(0, 0);

  // Sum scores — 13 members
  const maxScore = 10 * TOTAL;
  const totals = Array(13).fill(0);
  answers.forEach(a => { if (a) a.forEach((v, i) => { totals[i] += v; }); });

  const pcts = totals.map(t => Math.round((t / maxScore) * 100));

  const ranked = MEMBERS.map((m, i) => ({ ...m, pct: pcts[i], total: totals[i] }))
                        .sort((a, b) => b.total - a.total);

  const winner = ranked[0];

  // Normalize display so top member = 100% of their bar
  const normalized = ranked.map(r => ({ ...r, bar: Math.round((r.total / ranked[0].total) * 100) }));

  // Save to localStorage
  saveResult(currentUsername, winner.id, winner.epithet, totals);

  // Show username in result header
  document.getElementById('r-lbl').textContent = `PERFIL DE ALINEACIÓN — SUJETO: ${currentUsername.toUpperCase()}`;

  document.getElementById('r-name').textContent = winner.id;
  document.getElementById('r-name').style.color = winner.color;
  document.getElementById('r-name').style.textShadow = `0 0 40px ${winner.color}66, 0 0 80px ${winner.color}22`;
  document.getElementById('r-title').textContent = winner.epithet;
  document.getElementById('r-pct').textContent = winner.pct + '%';

  // Ranking rows
  const rankEl = document.getElementById('ranking');
  rankEl.innerHTML = '';
  normalized.forEach((m, i) => {
    const row = document.createElement('div');
    row.className = 'rank-row' + (i === 0 ? ' top1' : i === 1 ? ' top2' : '');
    row.innerHTML = `
      <div class="rank-num">#${i + 1}</div>
      <div class="rank-info">
        <div class="rank-member" style="${i < 2 ? 'color:' + m.color : ''}">${m.id} ${m.epithet}</div>
      </div>
      <div class="rank-bar-wrap">
        <div class="rank-bar-track"><div class="rank-bar-fill" id="rb${i}" style="width:0%;background:${m.color}${i === 0 ? '' : '88'}"></div></div>
        <div class="rank-score">${m.pct}%</div>
      </div>`;
    rankEl.appendChild(row);
  });
  setTimeout(() => { normalized.forEach((m, i) => { document.getElementById('rb' + i).style.width = m.bar + '%'; }); }, 120);

  // Profile texts
  document.getElementById('pt1').innerHTML = ranked[0].desc;
  document.getElementById('pc1').style.borderColor = ranked[0].color + '99';
  document.getElementById('pc1').setAttribute('data-lbl', 'ALINEACIÓN PRIMARIA — ' + ranked[0].id + ' ' + ranked[0].epithet);

  document.getElementById('pt2').innerHTML = ranked[1].desc2 || ranked[1].desc;
  document.getElementById('pc2').style.borderColor = ranked[1].color + '66';
  document.getElementById('pc2').setAttribute('data-lbl', 'ALINEACIÓN SECUNDARIA — ' + ranked[1].id + ' ' + ranked[1].epithet);

  document.getElementById('pt3').innerHTML = ranked[2].desc3 || ranked[2].desc;
  document.getElementById('pc3').style.borderColor = ranked[2].color + '44';
  document.getElementById('pc3').setAttribute('data-lbl', 'ALINEACIÓN TERCIARIA — ' + ranked[2].id + ' ' + ranked[2].epithet);

  // Bases de alineación
  const basesEl = document.getElementById('bases-box');
  basesEl.innerHTML = '';
  const intro = document.createElement('div');
  intro.className = 'bases-intro';
  intro.innerHTML = `Las siguientes decisiones determinaron la distribución de tu perfil. Para cada ítem se indica qué miembros del Consejo resultaron más favorecidos por tu elección.`;
  basesEl.appendChild(intro);

  answers.forEach((a, qi) => {
    if (!a) return;
    const scored = a.map((v, mi) => ({ mi, v, m: MEMBERS[mi] })).filter(x => x.v > 0).sort((a, b) => b.v - a.v);
    if (!scored.length) return;
    const top1 = scored[0];
    const top2 = scored[1] || null;

    const entry = document.createElement('div');
    entry.className = 'base-entry';
    entry.innerHTML = `
      <div class="base-q">ÍTEM ${String(qi + 1).padStart(2, '0')}</div>
      <div class="base-body">
        <div class="base-decision">${Q_LABELS[qi]}</div>
        <div class="base-tags">
          <span class="base-tag" style="border-color:${top1.m.color};color:${top1.m.color};background:${top1.m.color}11">${top1.m.id} +${top1.v}</span>
          ${top2 ? `<span class="base-tag" style="border-color:${top2.m.color}88;color:${top2.m.color}aa;background:${top2.m.color}08">${top2.m.id} +${top2.v}</span>` : ''}
        </div>
      </div>`;
    basesEl.appendChild(entry);
  });

  // Cognitive axes — 4 groups of the 13 members
  // Control: O5-1(0), O5-7(6), O5-12(11)
  // Knowledge: O5-2(1), O5-3(2), O5-9(8), O5-10(9)
  // Bonds: O5-4(3), O5-5(4), O5-6(5)
  // Opacity/Intel: O5-8(7), O5-11(10), O5-13(12)
  const grp = (indices) => {
    const t = indices.reduce((s, i) => s + totals[i], 0);
    const mx = indices.length * maxScore;
    return Math.round((t / mx) * 100);
  };
  document.getElementById('tv1').textContent = grp([0, 6, 11]) + '%';
  document.getElementById('tv2').textContent = grp([1, 2, 8, 9]) + '%';
  document.getElementById('tv3').textContent = grp([3, 4, 5]) + '%';
  document.getElementById('tv4').textContent = grp([7, 10, 12]) + '%';
}

function restart() {
  current = 0; answers = Array(TOTAL).fill(null);
  currentUsername = '';
  document.querySelectorAll('.qc,.nav,.prog-wrap,.intro,.members-section').forEach(el => el.style.display = '');
  cards.forEach(c => c.classList.remove('active'));
  cards[0].classList.add('active');
  document.querySelectorAll('.opt').forEach(b => b.classList.remove('sel'));
  document.getElementById('result').style.display = 'none';
  document.getElementById('prog-fill').style.width = '0%';
  document.getElementById('prog-pct').textContent = '0%';
  document.getElementById('prog-lbl').textContent = 'ÍTEM 1 / 16';
  btnPrev.disabled = true; btnNext.disabled = true;
  // Back to login
  document.getElementById('main-content').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('username-input').value = '';
  document.getElementById('login-error').textContent = '';
  window.scrollTo(0, 0);
}
</script>
</body>
</html>
